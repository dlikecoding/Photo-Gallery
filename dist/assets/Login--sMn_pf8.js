import{g as q,b as E,o as M,t as O,i as v,a as k,A as _,d as j,e as a,k as B,n as F}from"./index-BvSQAnfI.js";import{s as n}from"./Guard.module-DPCxz-nU.js";import{W as J}from"./toAuthenticatorAttachment-BAxCDoik.js";import{s as P}from"./startAuthentication-mwDUkj2u.js";import{I as T}from"./fetching-CJXmvtht.js";var W=O('<div><i style=--clr:#0051ff></i><i style=--clr:#fb00ff></i><i style=--clr:#41de2f></i><div><h2>Login</h2><p></p><div><input type=email name=email placeholder=Email autocomplete=off autofocus required></div><div><input type=button value="Sign In"></div><div>');const Q=()=>{const[c,t]=q({status:!1,msg:""}),[C,I]=E(),[N,R]=E(!1);M(()=>{requestAnimationFrame(()=>R(!0))});const L=async()=>{t("status",!0);const i=await fetch(`api/v1/auth/init-auth?email=${C()}`,{credentials:"same-origin"}),r=await i.json();if(!i.ok)return t({status:!1,msg:r.error});let o;try{o=await P({optionsJSON:r})}catch(u){return u instanceof J&&u.name==="NotAllowedError"?t({status:!1,msg:"Authenticator does not allowed."}):t({status:!1,msg:"Authenticator was missing biometric verification."})}const l=await T("api/v1/auth/verify-auth","POST",o),s=await l.json();if(!l.ok)return t({status:!1,msg:s.error});if(!s.verified)return t({status:!1,msg:"Failed to Sign In"});window.location.replace("/library/")};return(()=>{var i=W(),r=i.firstChild,o=r.nextSibling,l=o.nextSibling,s=l.nextSibling,u=s.firstChild,d=u.nextSibling,f=d.nextSibling,h=f.firstChild,m=f.nextSibling,p=m.firstChild,g=m.nextSibling;return v(d,()=>c.msg),h.addEventListener("focus",()=>t("msg","")),h.$$input=e=>{I(e.target.value)},p.$$click=L,v(g,k(_,{href:"/forget",children:"Lost key"}),null),v(g,k(_,{href:"/signup",children:"Need an account?"}),null),j(e=>{var y=`${n.ring} pageTransition ${N()?"pageEnter":""}`,S=n.login,b=c.status?"green":"red",$=n.inputBx,w=n.inputBx,x=c.status,A=n.links;return y!==e.e&&a(i,e.e=y),S!==e.t&&a(s,e.t=S),b!==e.a&&B(d,"color",e.a=b),$!==e.o&&a(f,e.o=$),w!==e.i&&a(m,e.i=w),x!==e.n&&(p.disabled=e.n=x),A!==e.s&&a(g,e.s=A),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),i})()};F(["input","click"]);export{Q as default};

import{g as x,b as k,o as q,t as M,i as $,a as B,A as V,d as H,e as R,k as G,n as F}from"./index-BvSQAnfI.js";import{s as p}from"./Guard.module-DPCxz-nU.js";import{W as s,i as J,b as W,t as Y,a as L,c as j,d as b,e as z}from"./toAuthenticatorAttachment-BAxCDoik.js";import{I as Q}from"./fetching-CJXmvtht.js";function X({error:e,options:i}){const{publicKey:n}=i;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(i.signal instanceof AbortSignal)return new s({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(n.authenticatorSelection?.requireResidentKey===!0)return new s({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(i.mediation==="conditional"&&n.authenticatorSelection?.userVerification==="required")return new s({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(n.authenticatorSelection?.userVerification==="required")return new s({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new s({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new s({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new s({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new s({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const l=globalThis.location.hostname;if(J(l)){if(n.rp.id!==l)return new s({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new s({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new s({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new s({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function Z(e){!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:i,useAutoRegister:n=!1}=e;if(!W())throw new Error("WebAuthn is not supported in this browser");const l={...i,challenge:L(i.challenge),user:{...i.user,id:L(i.user.id)},excludeCredentials:i.excludeCredentials?.map(Y)},o={};n&&(o.mediation="conditional"),o.publicKey=l,o.signal=j.createNewAbortSignal();let d;try{d=await navigator.credentials.create(o)}catch(r){throw X({error:r,options:o})}if(!d)throw new Error("Registration was not completed");const{id:E,rawId:c,response:a,type:m}=d;let f;typeof a.getTransports=="function"&&(f=a.getTransports());let u;if(typeof a.getPublicKeyAlgorithm=="function")try{u=a.getPublicKeyAlgorithm()}catch(r){w("getPublicKeyAlgorithm()",r)}let g;if(typeof a.getPublicKey=="function")try{const r=a.getPublicKey();r!==null&&(g=b(r))}catch(r){w("getPublicKey()",r)}let h;if(typeof a.getAuthenticatorData=="function")try{h=b(a.getAuthenticatorData())}catch(r){w("getAuthenticatorData()",r)}return{id:E,rawId:b(c),response:{attestationObject:b(a.attestationObject),clientDataJSON:b(a.clientDataJSON),transports:f,publicKeyAlgorithm:u,publicKey:g,authenticatorData:h},type:m,clientExtensionResults:d.getClientExtensionResults(),authenticatorAttachment:z(d.authenticatorAttachment)}}function w(e,i){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,i)}var ee=M('<div><i style=--clr:#0051ff></i><i style=--clr:#fb00ff></i><i style=--clr:#41de2f></i><div><h2>Register</h2><p></p><div><input type=email name=email placeholder=Email* autocomplete=off autofocus required></div><div><input type=text name=username placeholder="Full Name"minlength=5 autocomplete=off required></div><div><input type=button value="Create Account"></div><div><div>');const re=()=>{const[e,i]=x({status:!1,msg:""}),[n,l]=x(),[o,d]=k(!1);q(()=>{requestAnimationFrame(()=>d(!0))});const E=async()=>{i("status",!0);const c=await fetch(`api/v1/auth/init-register?email=${n.email}&username=${n.name}`,{credentials:"same-origin"}),a=await c.json();if(!c.ok)return i({status:!1,msg:a.error});let m;try{m=await Z({optionsJSON:a})}catch(g){return g instanceof s&&g.name==="NotAllowedError"?i({status:!1,msg:"Authenticator was missing biometric verification."}):i({status:!1,msg:"Authenticator was missing biometric verification."})}const f=await Q("api/v1/auth/verify-register","POST",m),u=await f.json();if(!f.ok)return i({status:!1,msg:u.error});if(!u.verified)return i({status:!1,msg:"Failed to register"});window.location.replace("/login")};return(()=>{var c=ee(),a=c.firstChild,m=a.nextSibling,f=m.nextSibling,u=f.nextSibling,g=u.firstChild,h=g.nextSibling,r=h.nextSibling,S=r.firstChild,y=r.nextSibling,_=y.firstChild,A=y.nextSibling,O=A.firstChild,v=A.nextSibling;return v.firstChild,$(h,()=>e.msg),S.addEventListener("focus",()=>i("msg","")),S.$$input=t=>l("email",t.target.value),_.addEventListener("focus",()=>i("msg","")),_.$$input=t=>l("name",t.target.value),O.$$click=E,$(v,B(V,{href:"/login",style:{"text-align":"right"},children:"Already have an account?"}),null),H(t=>{var T=`${p.ring} pageTransition ${o()?"pageEnter":""}`,I=p.login,P=e.status?"green":"red",N=p.inputBx,C=p.inputBx,D=p.inputBx,U=e.status,K=p.links;return T!==t.e&&R(c,t.e=T),I!==t.t&&R(u,t.t=I),P!==t.a&&G(h,"color",t.a=P),N!==t.o&&R(r,t.o=N),C!==t.i&&R(y,t.i=C),D!==t.n&&R(A,t.n=D),U!==t.s&&(O.disabled=t.s=U),K!==t.h&&R(v,t.h=K),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),c})()};F(["input","click"]);export{re as default};

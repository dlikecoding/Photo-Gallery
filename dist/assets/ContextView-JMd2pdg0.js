import{B as Vt,b as K,a as b,C as Rt,g as le,c as F,E as mt,o as be,w as jt,G as Wt,x as Me,t as L,q as he,i as _,d as N,e as f,l as W,M as ge,S as Qe,k as de,s as Q,H as Te,n as te,f as Ue,F as we,p as Le,P as Pe,J as rn,K as ht,m as se,V as Ut,L as He,I as Ht,N as an}from"./index-BvSQAnfI.js";import{u as ve,a as Zt,b as Yt,Z as sn}from"./ManageUrl-C3xxHPBd.js";import{i as ln,j as dn,k as cn,l as un,m as vn,n as mn,o as hn,p as fn,q as gn,r as _n,s as bn,t as pn,u as $n,v as wn,w as yn,x as yt}from"./fetching-CJXmvtht.js";import Gt from"./NotFound-BxO3YEod.js";import{c as In,F as Sn,Z as ft,M as xn,d as Cn,e as Mn,f as Tn,D as kn,I as Ln,G as Xt,g as qt,E as En,b as Dn,h as Pn,i as An,j as On,k as Bn,l as zn,m as Kt,n as Fn,o as Nn,p as Vn}from"./svgIcons-CL4uA8j0.js";import{c as lt,f as De,s as Rn,a as It,b as jn,g as Wn}from"./helper-CM3Kw7rw.js";import{I as Un}from"./ImportLoading-DdWe640l.js";import{L as Jt}from"./Loading-CfSZg7CJ.js";import{S as tt}from"./SlideUp-3jdboGv6.js";import{H as Hn}from"./Header-9gxCup_c.js";const Qt=Rt(),Zn=e=>{const[t,i]=K(new Map),[o,n]=K(!1),d=(g,r)=>{i(new Map([[g,r]]))};return b(Qt.Provider,{value:{items:t,setOneItem:d,setItems:i,isSelected:o,setIsSelected:n},get children(){return e.children}})},oe=()=>Vt(Qt),nt="selected-card",en=Rt(),Yn=e=>{const[t,i]=le([]),[o,n]=le(xt()),d=()=>{c(St())},g=y=>{n(xt(y))};F(()=>{o.isOpen||n("isEditing",!1)}),F(()=>n("showImage",o.isEditing));const[r,c]=le(St()),[p,v]=le(dt());return b(en.Provider,{value:{displayMedias:t,setDisplayMedia:i,openModal:o,setOpenModal:n,mouseGesture:r,setMouseGesture:c,translate:p,setTranslate:v,resetModal:g,resetMouse:d},get children(){return e.children}})},ee=()=>Vt(en),dt=()=>({x:0,y:0}),St=()=>({start:dt(),end:dt(),action:"",drag:!1,status:!1}),xt=e=>({isOpen:!1,activeIdx:-1,transitionMediaId:e?.transitionMediaId??null,transitionPhase:e?.transitionPhase??null,isEditing:!1,showImage:!1}),Gn="_virtualContainer_1vr9z_5",Xn="_mediaContainer_1vr9z_13",qn="_customBottomPadding_1vr9z_22",Kn="_imageContainer_1vr9z_37",Jn="_selectedIcon_1vr9z_76",Qn="_overlayText_1vr9z_88",ei="_overlayLive_1vr9z_97",ti="_overlayFavorite_1vr9z_108",Se={virtualContainer:Gn,mediaContainer:Xn,customBottomPadding:qn,imageContainer:Kn,selectedIcon:Jn,overlayText:Qn,overlayLive:ei,overlayFavorite:ti},Ct=Promise.resolve();function ni(e){return e?Ct.then(this?e.bind(this):e):Ct}function tn(e){return typeof e=="function"}function Ce(e){return typeof e=="function"?e():e}const ii=typeof window<"u",oi=e=>e!=null,ri=Object.prototype.toString,ai=e=>ri.call(e)==="[object Object]",Ke=()=>{};function it(e){return mt()?(Me(e),!0):!1}function si(e,t){const i={};return Object.keys(e).forEach(o=>{i[o]=F(()=>e[o]??void 0)}),i}function ot(e,t,i){const[o,n]=K(!0);return jt(Wt(li(e),(g,r,c)=>{o()&&t(g,r,c)},i)),()=>{n(!1)}}function li(e){return Array.isArray(e)?e:ai(e)?Object.values(si(e)):tn(e)?e:()=>e}function ct(e){return tn(e)?e:()=>e}function di(e,t=!0){mt()?be(e):t?e():ni(e)}const Ae=ii?window:void 0;function fe(...e){let t,i,o,n;if(typeof e[0]=="string"||Array.isArray(e[0])?([i,o,n]=e,t=Ae):[t,i,o,n]=e,!t)return Ke;Array.isArray(i)||(i=[i]),Array.isArray(o)||(o=[o]);const d=[],g=()=>{d.forEach(v=>v()),d.length=0},r=(v,y,I,h)=>(v.addEventListener(y,I,h),()=>v.removeEventListener(y,I,h)),c=ot([ct(t),ct(n)],([v,y])=>{g(),v&&d.push(...i.flatMap(I=>o.map(h=>r(v,I,h,y))))}),p=()=>{c(),g()};return it(p),p}function ci(){const[e,t]=K(!1);return mt()&&be(()=>{t(!0)}),e}function gt(e){const t=ci();return F(()=>(t(),!!e()))}function ui(e,t={}){const{window:i=Ae}=t,o=gt(()=>i&&"matchMedia"in i&&typeof i.matchMedia=="function");let n;const[d,g]=K(!1),r=v=>{g(v.matches)},c=()=>{n&&("removeEventListener"in n?n.removeEventListener("change",r):n.removeListener(r))},p=ot([ct(e),o],()=>{o()&&(c(),n=i.matchMedia(Ce(e)),"addEventListener"in n?n.addEventListener("change",r):n.addListener(r),g(n.matches))});return it(()=>{p(),c(),n=void 0}),d}function vi(e,t,i={}){const{window:o=Ae,...n}=i;let d;const g=gt(()=>o&&"ResizeObserver"in o),r=()=>{d&&(d.disconnect(),d=void 0)},c=F(()=>Array.isArray(e)?e.map(Ce):[Ce(e)]),p=ot(c,y=>{if(r(),g()&&o){d=new ResizeObserver(t);for(const I of y)I&&d.observe(I,n)}},{defer:!1}),v=()=>{r(),p()};return it(v),{isSupported:g,stop:v}}function mi(e,t,i={}){const{root:o,rootMargin:n="0px",threshold:d=.1,window:g=Ae,immediate:r=!0}=i,c=gt(()=>g&&"IntersectionObserver"in g),p=F(()=>{const a=Ce(e);return(Array.isArray(a)?a:[a]).map(Ce).filter(oi)});let v=Ke;const[y,I]=K(r),h=c()?ot(()=>[p(),Ce(o),y],([a,u,S])=>{if(v(),!S||!a.length)return;const w=new IntersectionObserver(t,{root:Ce(u),rootMargin:n,threshold:d});a.forEach($=>$&&w.observe($)),v=()=>{w.disconnect(),v=Ke}},{defer:!r}):Ke,l=()=>{v(),h(),I(!1)};return it(l),{isSupported:c,isActive:y,pause(){v(),I(!1)},resume(){I(!0)},stop:l}}function hi(e={}){const{touch:t=!0,drag:i=!0,initialValue:o=!1,window:n=Ae}=e,[d,g]=K(o),[r,c]=K(null);if(!n)return{pressed:d,sourceType:r};const p=I=>()=>{g(!0),c(I)},v=()=>{g(!1),c(null)},y=F(()=>Ce(e.target)??n);return fe(y,"mousedown",p("mouse"),{passive:!0}),fe(n,"mouseleave",v,{passive:!0}),fe(n,"mouseup",v,{passive:!0}),i&&(fe(y,"dragstart",p("mouse"),{passive:!0}),fe(n,"drop",v,{passive:!0}),fe(n,"dragend",v,{passive:!0})),t&&(fe(y,"touchstart",p("touch"),{passive:!0}),fe(n,"touchend",v,{passive:!0}),fe(n,"touchcancel",v,{passive:!0})),{pressed:d,sourceType:r}}function fi(e={}){const{window:t=Ae,initialWidth:i=Number.POSITIVE_INFINITY,initialHeight:o=Number.POSITIVE_INFINITY,listenOrientation:n=!0,includeScrollbar:d=!0}=e,[g,r]=K(i),[c,p]=K(o),v=()=>{t&&(d?(r(t.innerWidth),p(t.innerHeight)):(r(t.document.documentElement.clientWidth),p(t.document.documentElement.clientHeight)))};if(v(),di(v),fe("resize",v,{passive:!0}),n){const y=ui("(orientation: portrait)");jt(Wt(y,()=>{v()}))}return{width:g,height:c}}const We={top:70,bottomWithResult:130,bottomTimelineWithResult:170};var Xe=L("<div>"),gi=L('<div><div inert><img decoding=async loading=lazy alt="Image not found">',!0,!1,!1);const _i=e=>{const t=()=>e.index,i=()=>e.media,o=()=>e.lastItem,n=()=>e.itemDim,d=()=>e.gap,{items:g,setItems:r,setOneItem:c,isSelected:p}=oe(),{view:v}=ve(),{openModal:y,setOpenModal:I}=ee(),h=(u,S)=>{window.history.pushState({state:"Photo Modal"},"",window.location.href),c(u,S),I("isOpen",!0)},l=(u,S)=>{if(p()){const M=new Map(g());M.has(u)?M.delete(u):M.set(u,S),r(M);return}const w=document.documentElement,$=document.startViewTransition?.bind(document);if(!$)return h(u,S);I({transitionMediaId:S,activeIdx:u,transitionPhase:"opening"}),w.classList.add("vt-opening"),$(()=>{h(u,S)}).finished.finally(()=>{I({transitionMediaId:null,transitionPhase:null}),w.classList.remove("vt-opening")})},a=F(()=>{const u=n()+d();return{top:Math.floor(t()/v.nColumn)*u+We.top,left:t()%v.nColumn*u,size:n()}});return(()=>{var u=gi(),S=u.firstChild,w=S.firstChild;u.$$click=()=>l(t(),i().media_id);var $=o();return typeof $=="function"&&he($,u),_(S,b(W,{get when(){return g().has(t())},get children(){var s=Xe();return N(()=>f(s,Se.selectedIcon)),s}}),w),_(S,b(W,{get when(){return i().favorite},get children(){var s=Xe();return N(()=>f(s,Se.overlayFavorite)),s}}),w),_(S,b(Qe,{get children(){return[b(ge,{get when(){return i().file_type==="Live"},get children(){var s=Xe();return N(()=>f(s,Se.overlayLive)),s}}),b(ge,{get when(){return i().file_type==="Video"},get children(){var s=Xe();return _(s,()=>i().video_duration),N(()=>f(s,Se.overlayText)),s}})]}}),w),N(s=>{var M=Se.mediaContainer,D=`${a().top}px`,E=`${a().left}px`,P=`${a().size}px`,V=`${a().size}px`,T=i().media_id,O=t(),U=Se.imageContainer,H=i().thumb_path,k={"object-fit":v.objectFit?"cover":"contain",...!y.isOpen&&y.transitionMediaId===i().media_id?{"view-transition-name":nt}:{}};return M!==s.e&&f(u,s.e=M),D!==s.t&&de(u,"top",s.t=D),E!==s.a&&de(u,"left",s.a=E),P!==s.o&&de(u,"width",s.o=P),V!==s.i&&de(u,"height",s.i=V),T!==s.n&&Q(u,"data-id",s.n=T),O!==s.s&&Q(u,"data-idx",s.s=O),U!==s.h&&f(S,s.h=U),H!==s.r&&Q(w,"src",s.r=H),s.d=Te(w,k,s.d),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),u})()};te(["click"]);var bi=L("<button popovertarget=devices-filter-popover style=anchor-name:--devices-filter-trigger>"),pi=L('<div popover=auto id=devices-filter-popover class="popover-container devices_filter_popover"style="transform-origin:top center"><span class=clear_button>Clear Filter'),$i=L("<div>");const wi=()=>{const{isSelected:e}=oe(),{updatePageKey:t}=ve(),[i]=Ue(ln),[o,n]=K(null);return b(W,{get when(){return!e()},get children(){return[(()=>{var d=bi();return _(d,In),d})(),(()=>{var d=pi(),g=d.firstChild;return g.$$click=r=>{r.stopPropagation(),t("filterDevice",void 0)},_(d,b(we,{get each(){return i()},children:r=>(()=>{var c=$i();return c.$$click=p=>{p.stopPropagation(),n(r.camera_id),t("filterDevice",r.camera_id)},_(c,()=>r.model),N(()=>f(c,o()===r.camera_id?"activeFilter":"")),c})()}),null),d})()]}})};te(["click"]);var yi=L("<button>");const Ii=e=>{const{items:t}=oe(),{openModal:i,displayMedias:o}=ee(),n=F(()=>{if(!i.isOpen||!t().size)return!1;const d=t().keys().next().value;return d===void 0||d<0?!1:o[d]?o[d].favorite:!1});return(()=>{var d=yi();return Le(d,"click",e.action,!0),_(d,()=>Sn(n())),d})()};te(["click"]);const Si="_backdrop_1gffw_9",xi="_sheet_1gffw_22",Ci="_header_1gffw_49",Mi="_headerTitle_1gffw_57",Ti="_headerButton_1gffw_64",ki="_dialogContainer_1gffw_85",Li="_dialogHeader_1gffw_109",Ei="_dialogTitle_1gffw_113",Di="_dialogSubtitle_1gffw_119",Pi="_inputContainer_1gffw_125",Ai="_dialogButtons_1gffw_151",Oi="_dialogBtn_1gffw_156",Bi="_cancelBtn_1gffw_167",zi="_saveBtn_1gffw_171",Fi="_listOfAlbums_1gffw_177",Ni="_albumCard_1gffw_186",Vi="_albumTitle_1gffw_205",Ri="_albumCount_1gffw_212",j={backdrop:Si,sheet:xi,header:Ci,headerTitle:Mi,headerButton:Ti,dialogContainer:ki,dialogHeader:Li,dialogTitle:Ei,dialogSubtitle:Di,inputContainer:Pi,dialogButtons:Ai,dialogBtn:Oi,cancelBtn:Bi,saveBtn:zi,listOfAlbums:Fi,albumCard:Ni,albumTitle:Vi,albumCount:Ri};var ji=L('<div><div><dialog id=dialogCollectionContainer><div><div>New Album</div><div>Enter a name for this album.</div></div><div><input type=text placeholder=Title></div><div><button type=button>Cancel</button><button type=button>Create</button></div></dialog><div><button type=button>Cancel</button><h4>Add to Album</h4><button type=button aria-label="New album"></button></div><div>'),Wi=L("<button type=button><img><div></div><span>");const Ui=e=>{const{items:t,setIsSelected:i}=oe(),[o]=Ue(e.fetchAlbums),[n,d]=K(""),g=()=>{e.onClose(),d("")},r=async(v,y)=>{const I=Array.from(t().values());return(await e.updateAlbums(I,v,y)).ok?(i(!1),g(),!0):(alert("Cannot add elements to album"),!1)};let c;const p=v=>{c&&(v?c.showModal():c.close())};return b(Pe,{get children(){var v=ji(),y=v.firstChild,I=y.firstChild,h=I.firstChild,l=h.firstChild,a=l.nextSibling,u=h.nextSibling,S=u.firstChild,w=u.nextSibling,$=w.firstChild,s=$.nextSibling,M=I.nextSibling,D=M.firstChild,E=D.nextSibling,P=E.nextSibling,V=M.nextSibling;return he(T=>c=T,I),S.$$input=T=>d(T.currentTarget.value),$.$$click=()=>{d(""),p(!1)},s.$$click=async()=>{await r(void 0,n().trim())&&(d(""),p(!1))},D.$$click=g,P.$$click=()=>p(!0),_(P,ft),_(V,b(we,{get each(){return o()},children:T=>(()=>{var O=Wi(),U=O.firstChild,H=U.nextSibling,k=H.nextSibling;return O.$$click=async()=>{await r(T.album_id)},_(H,()=>T.title),_(k,()=>T.media_count),N(R=>{var Y=j.albumCard,A=T.thumb_path,m=T.title,x=j.albumTitle,z=j.albumCount;return Y!==R.e&&f(O,R.e=Y),A!==R.t&&Q(U,"src",R.t=A),m!==R.a&&Q(U,"alt",R.a=m),x!==R.o&&f(H,R.o=x),z!==R.i&&f(k,R.i=z),R},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),O})()})),N(T=>{var O=j.backdrop,U=j.sheet,H=j.dialogContainer,k=j.dialogHeader,R=j.dialogTitle,Y=j.dialogSubtitle,A=j.inputContainer,m=j.dialogButtons,x=`${j.dialogBtn} ${j.cancelBtn}`,z=`${j.dialogBtn} ${j.saveBtn}`,B=!n().trim(),C=j.header,G=j.headerButton,X=j.headerTitle,J=j.headerButton,ne=j.listOfAlbums;return O!==T.e&&f(v,T.e=O),U!==T.t&&f(y,T.t=U),H!==T.a&&f(I,T.a=H),k!==T.o&&f(h,T.o=k),R!==T.i&&f(l,T.i=R),Y!==T.n&&f(a,T.n=Y),A!==T.s&&f(u,T.s=A),m!==T.h&&f(w,T.h=m),x!==T.r&&f($,T.r=x),z!==T.d&&f(s,T.d=z),B!==T.l&&(s.disabled=T.l=B),C!==T.u&&f(M,T.u=C),G!==T.c&&f(D,T.c=G),X!==T.w&&f(E,T.w=X),J!==T.m&&f(P,T.m=J),ne!==T.f&&f(V,T.f=ne),T},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0}),N(()=>S.value=n()),v}})};te(["input","click"]);const Hi="_chips_8jn0a_4",Zi="_intro_8jn0a_12",Yi="_introIcon_8jn0a_23",Gi="_introText_8jn0a_36",Xi="_introTitle_8jn0a_43",qi="_introDesc_8jn0a_50",Ki="_chip_8jn0a_4",Ji="_chipGroup_8jn0a_74",Qi="_chipNeutral_8jn0a_82",eo="_chipAlert_8jn0a_86",to="_listOfItems_8jn0a_92",no="_card_8jn0a_101",io="_cardDefault_8jn0a_111",oo="_cardBlocked_8jn0a_115",ro="_thumbWrap_8jn0a_120",ao="_thumb_8jn0a_120",so="_thumbPlaceholder_8jn0a_138",lo="_meta_8jn0a_145",co="_rowTop_8jn0a_150",uo="_name_8jn0a_157",vo="_status_8jn0a_168",mo="_detailLine_8jn0a_177",ho="_reason_8jn0a_184",fo="_ok_8jn0a_191",go="_blocked_8jn0a_197",_o="_pending_8jn0a_203",q={chips:Hi,intro:Zi,introIcon:Yi,introText:Gi,introTitle:Xi,introDesc:qi,chip:Ki,chipGroup:Ji,chipNeutral:Qi,chipAlert:eo,listOfItems:to,card:no,cardDefault:io,cardBlocked:oo,thumbWrap:ro,thumb:ao,thumbPlaceholder:so,meta:lo,rowTop:co,name:uo,status:vo,detailLine:mo,reason:ho,ok:fo,blocked:go,pending:_o};var bo=L('<div><div><dialog id=dialogCollectionContainer><div><div>New Album</div><div>Enter a name for this album.</div></div></dialog><div><button type=button>Cancel</button><h4>Merge videos</h4><button type=button aria-label="Merge videos">Merge</button></div><div><div><div>Mix</div><div><p>Merge to a single video</p><p>Selected videos and Live Photos will be combined into one output, replacing the originals using the first item as the base.</p></div></div><div><span></span><span> selected</span></div></div><div>'),po=L("<img loading=lazy>",!0,!1,!1),$o=L("<p>"),wo=L("<div><div></div><div><div><p></p><button></button></div><p> • <!> • <!> × </p><p>Duration: <!> • <!> MP • <!> fps • "),yo=L("<div>No preview");const Io=e=>{const{items:t,setItems:i,setIsSelected:o}=oe(),{displayMedias:n,setDisplayMedia:d}=ee(),[g,r]=le([]),[c,p]=le({summary:"Pick videos with matching dimensions to continue."}),[v,y]=le({mesg:"",isRunning:!1}),I=(S=!1)=>{e.onClose(),S&&o(!1),r([])};be(()=>{if(!t().size)return;const S=Array.from(t().keys()).map(s=>({idx:s,...n[s]})),w=S.find(s=>s.file_type==="Video"||s.file_type==="Live")??S[0],$=w.image_width&&w.image_height?`${w.image_width} × ${w.image_height}`:"Same resolution required";for(const s of S){let M="ok",D="";s.file_type==="Photo"?(M="blocked",D="Only videos or live photos can be merged."):!s.image_width||!s.image_width||!s.duration?(M="blocked",D="Missing dimension data."):s.image_width!==w.image_width||s.image_height!==w.image_height?(M="blocked",D=`Resolution need to match ${$}`):s.megapixels!==w.megapixels?(M="blocked",D=`Pixel does not match ${$}`):s.frame_rate!==w.frame_rate&&(M="blocked",D=`Frame rate ${s.frame_rate} fps does not match ${w.frame_rate} fps`);const E={...s,status:M,reason:D};r(P=>[...P,E])}p({summary:h().length>0?"Replace items below before merging.":`Ready to merge ${g.length} video(s) at ${$}.`})});const h=F(()=>g.filter(S=>S.status==="blocked")),l=async()=>{if(h().length>0)return p({summary:"Please remove video(s) below before start merging. "});y({mesg:"Start processing. Please wait...",isRunning:!0});const S=[...t().values()],$=await(await dn(S)).json();if($.status==="Success"){const{mergedMedia:M,removeIds:D}=$,E=new Set(D??[]);rn(()=>{d(P=>{const V=[];for(const T of P)if(!E.has(T.media_id))if(T.media_id===M.media_id){const O={file_size:M.file_size,duration:M.duration,file_type:M.file_type,video_duration:M.video_duration};V.push({...T,...O})}else V.push(T);return V}),I(!0)})}y({mesg:"",isRunning:!1}),p({summary:$.error?$.error:"Failed to process merging videos"});const s=Array.isArray($.validationIssues)?$.validationIssues:[];for(const M of s){const D=Number(M.media_id??M.mediaId);if(!Number.isFinite(D))continue;const E=M.issues;r(P=>P.media_id===D,{status:"blocked",reason:E})}},a=S=>({ok:"Matched",blocked:"Remove"})[S],u=(S,w)=>{const $=new Map(t());$.has(S)&&$.delete(S),i($),r(s=>s.filter(M=>M.media_id!==w)),t().size<=1&&I()};return b(Pe,{get children(){return[(()=>{var S=bo(),w=S.firstChild,$=w.firstChild,s=$.firstChild,M=s.firstChild,D=M.nextSibling,E=$.nextSibling,P=E.firstChild,V=P.nextSibling,T=V.nextSibling,O=E.nextSibling,U=O.firstChild,H=U.firstChild,k=H.nextSibling,R=k.firstChild,Y=R.nextSibling,A=U.nextSibling,m=A.firstChild,x=m.nextSibling,z=x.firstChild,B=O.nextSibling;return Le(P,"click",e.onClose,!0),T.$$click=l,_(m,()=>c.summary),_(x,()=>g.length,z),_(B,b(we,{each:g,children:C=>(()=>{var G=wo(),X=G.firstChild,J=X.nextSibling,ne=J.firstChild,re=ne.firstChild,ue=re.nextSibling,ae=ne.nextSibling,ye=ae.firstChild,Ie=ye.nextSibling,ke=Ie.nextSibling,Oe=ke.nextSibling;Oe.nextSibling;var pe=ae.nextSibling,Ze=pe.firstChild,Be=Ze.nextSibling,Ye=Be.nextSibling,ze=Ye.nextSibling,Ge=ze.nextSibling,Fe=Ge.nextSibling;return Fe.nextSibling,_(X,b(W,{get when(){return C.thumb_path},get fallback(){return(()=>{var Z=yo();return N(()=>f(Z,q.thumbPlaceholder)),Z})()},get children(){var Z=po();return N(ce=>{var Ne=C.thumb_path,Ve=C.mime_type,Re=q.thumb;return Ne!==ce.e&&Q(Z,"src",ce.e=Ne),Ve!==ce.t&&Q(Z,"alt",ce.t=Ve),Re!==ce.a&&f(Z,ce.a=Re),ce},{e:void 0,t:void 0,a:void 0}),Z}})),_(re,()=>C.file_name.split(".")[0]),ue.$$click=()=>{u(C.idx,C.media_id)},_(ue,()=>a(C.status)),_(ae,()=>C.file_ext,ye),_(ae,()=>C.mime_type||"Unknown codec",Ie),_(ae,()=>C.image_width,Oe),_(ae,()=>C.image_height,null),_(pe,()=>C.video_duration||"Unknown",Be),_(pe,()=>C.megapixels,ze),_(pe,()=>C.frame_rate||"Unknown",Fe),_(pe,()=>lt(C.file_size),null),_(J,b(W,{get when(){return C.reason},get children(){var Z=$o();return _(Z,()=>C.reason),N(()=>f(Z,q.reason)),Z}}),null),N(Z=>{var ce=`${q.card} ${C.status==="blocked"?q.cardBlocked:q.cardDefault}`,Ne=q.thumbWrap,Ve=q.meta,Re=q.rowTop,bt=q.name,pt=`${q.status} ${q[C.status]}`,$t=q.detailLine,wt=q.detailLine;return ce!==Z.e&&f(G,Z.e=ce),Ne!==Z.t&&f(X,Z.t=Ne),Ve!==Z.a&&f(J,Z.a=Ve),Re!==Z.o&&f(ne,Z.o=Re),bt!==Z.i&&f(re,Z.i=bt),pt!==Z.n&&f(ue,Z.n=pt),$t!==Z.s&&f(ae,Z.s=$t),wt!==Z.h&&f(pe,Z.h=wt),Z},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),G})()})),N(C=>{var G=j.backdrop,X=j.sheet,J=j.dialogContainer,ne=j.dialogHeader,re=j.dialogTitle,ue=j.dialogSubtitle,ae=j.header,ye=j.headerButton,Ie=j.headerTitle,ke=j.headerButton,Oe=q.chips,pe=q.intro,Ze=q.introIcon,Be=q.introText,Ye=q.introTitle,ze=q.introDesc,Ge=q.chipGroup,Fe=`${q.chip} ${h().length?q.chipAlert:q.chipNeutral}`,Z=`${q.chip} ${h().length>0?q.chipAlert:q.chipNeutral}`,ce=q.listOfItems;return G!==C.e&&f(S,C.e=G),X!==C.t&&f(w,C.t=X),J!==C.a&&f($,C.a=J),ne!==C.o&&f(s,C.o=ne),re!==C.i&&f(M,C.i=re),ue!==C.n&&f(D,C.n=ue),ae!==C.s&&f(E,C.s=ae),ye!==C.h&&f(P,C.h=ye),Ie!==C.r&&f(V,C.r=Ie),ke!==C.d&&f(T,C.d=ke),Oe!==C.l&&f(O,C.l=Oe),pe!==C.u&&f(U,C.u=pe),Ze!==C.c&&f(H,C.c=Ze),Be!==C.w&&f(k,C.w=Be),Ye!==C.m&&f(R,C.m=Ye),ze!==C.f&&f(Y,C.f=ze),Ge!==C.y&&f(A,C.y=Ge),Fe!==C.g&&f(m,C.g=Fe),Z!==C.p&&f(x,C.p=Z),ce!==C.b&&f(B,C.b=ce),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0}),S})(),b(Un,{streamMesg:v,setStreamMesg:y})]}})};te(["click"]);var So=L("<button popovertarget=actions_contents style=anchor-name:--more-button-trigger>"),xo=L("<div>Remove from Album"),Co=L('<div popover=auto id=actions_contents class="popover-container actions_contents"><div>Hide Photos/Videos</div><div>Merge Lives-Videos</div><div>Slideshow (...)'),Mo=L("<div>Add to Album");const To=e=>{const t=ht(),{items:i,setItems:o,setIsSelected:n}=oe(),{setDisplayMedia:d}=ee(),[g,r]=le({addAlbum:!1,mergeVideo:!1});let c;const p=()=>{r("addAlbum",!0),c&&c.hidePopover()},v=async()=>{const I=new Set(i().keys()),h=new Set(i().values());(await vn([...h],parseInt(t.id))).ok||alert("Failed to remove media from album!"),d(a=>a.filter((u,S)=>!I.has(S))),n(!1),o(new Map)},y=()=>{if(c&&c.hidePopover(),i().size<2){alert("Select at least two videos to merge.");return}r("mergeVideo",!0)};return[(()=>{var I=So();return _(I,xn),I})(),(()=>{var I=Co(),h=I.firstChild,l=h.nextSibling;return he(a=>c=a,I),_(I,b(W,{get when(){return t.pages==="album"},get fallback(){return(()=>{var a=Mo();return a.$$click=p,a})()},get children(){var a=xo();return a.$$click=v,a}}),h),Le(h,"click",e.hide,!0),l.$$click=y,I})(),b(W,{get when(){return g.addAlbum},get children(){return b(Ui,{onClose:()=>r("addAlbum",!1),fetchAlbums:un,updateAlbums:cn})}}),b(W,{get when(){return g.mergeVideo},get children(){return b(Io,{get open(){return g.mergeVideo},onClose:()=>r("mergeVideo",!1)})}})]};te(["click"]);var ko=L("<button>");const Lo=1*1024**3,Mt=10,Eo=50*1024**2,Do=()=>{const{items:e,setItems:t,setIsSelected:i}=oe(),{openModal:o,displayMedias:n}=ee(),[d,g]=K(!1),r=async c=>{if(c.preventDefault(),c.stopPropagation(),!e()||!e().size)return;const p=Po(e(),n);if(p){if(p.canShare){if(!await Ao(p.medias,g))return}else g(!0),await Bo(e()),g(!1);o.isOpen||(i(!1),t(new Map))}};return[(()=>{var c=ko();return c.$$click=p=>r(p),_(c,Cn),c})(),b(W,{get when(){return d()},get children(){return b(Jt,{})}})]},Po=(e,t)=>{if(e.size>Mt)return alert(`You can only select up to ${Mt} files.`),null;let o=0;const n=[];for(const[d,g]of e){const r=t[d];if(o+=Number(r.file_size),o>Lo)return alert("Selected files exceeds 1GB limit."),null;n.push(r)}return{medias:n,canShare:o<=Eo}},Ao=async(e,t)=>{const i=[];t(!0);for(const o of e){const n=await Oo(o.source_file);n&&i.push(n)}t(!1);try{if(navigator.canShare&&navigator.canShare({files:i}))return await navigator.share({files:i}),!0}catch(o){return console.log(`Error sharing files: ${o}`),!1}},Oo=async e=>{try{const t=await fetch(e,{method:"GET",credentials:"same-origin"});if(!t.ok)throw new Error(`Failed fetch: ${e}`);const i=await t.blob(),o=e.split("/").pop()||"file";return new File([i],o)}catch(t){return console.error("Fetch file error:",t),null}},Bo=async e=>{const t=new Set(e.values()),i=await mn([...t]);if(!i.ok)return alert("Failed to download photos/video.");const o=await i.blob(),n=URL.createObjectURL(o),d=document.createElement("a");d.href=n,d.download="PhotoX.zip",d.rel="noopener",d.target="_blank",d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),setTimeout(()=>URL.revokeObjectURL(n),1e3)};te(["click"]);var zo=L("<button popovertarget=recover-contents>");const Fo=e=>{const{items:t}=oe(),i=()=>`Recover ${t().size} Photo(s)`;return[(()=>{var o=zo();return _(o,Mn),o})(),b(tt,{idElement:"recover-contents",noticeText:"Recovery deleted media back to server",get confirmBtn(){return e.action},infoText:i})]};var No=L("<button>");const Vo=e=>(()=>{var t=No();return Le(t,"click",e.action,!0),_(t,Tn),t})();te(["click"]);var Ro=L("<button popovertarget=delete-contents>");const jo=e=>{const{items:t,setItems:i,setIsSelected:o}=oe(),{displayMedias:n,setDisplayMedia:d}=ee(),g=async()=>{const v=new Set(t().keys()),y=new Set(t().values()),I=await hn([...y]);if(!I.ok)return console.error(`Failed to delete ${[...y]}:`,I);d(h=>h.filter((l,a)=>!v.has(a))),o(!1),i(new Map),!(n.length>0)&&window.history.back()},r=e.isDeletePage?"The photo(s) will be moved to the Recently Deleted for 30 days before being permanently deleted.":"This will permanently delete the selected photo(s). This action can't be undone",c=()=>e.isDeletePage?e.delete():g(),p=()=>`Delete ${t().size} Photo(s)`;return[(()=>{var v=Ro();return _(v,kn),v})(),b(tt,{idElement:"delete-contents",noticeText:r,confirmBtn:c,infoText:p})]},Wo="_infoSheet_4r2jv_1",Uo="_mediaInfo_4r2jv_23",Ho="_caption_4r2jv_48",Zo="_dateInfo_4r2jv_91",Yo="_linkButton_4r2jv_107",Go="_fileName_4r2jv_124",Xo="_infoOfMedia_4r2jv_137",qo="_cameraInfo_4r2jv_162",Ko="_addLocation_4r2jv_202",me={infoSheet:Wo,mediaInfo:Uo,caption:Ho,dateInfo:Zo,linkButton:Yo,fileName:Go,infoOfMedia:Xo,cameraInfo:qo,addLocation:Ko},Jo="_panel_13uz0_14",Qo="_summaryCard_13uz0_20",er="_summaryLabel_13uz0_29",tr="_summaryValue_13uz0_36",nr="_summaryMeta_13uz0_43",ir="_editor_13uz0_49",or="_fieldLabel_13uz0_59",rr="_dateInput_13uz0_66",ar="_helperRow_13uz0_85",sr="_helperButton_13uz0_92",lr="_preview_13uz0_116",dr="_previewLabel_13uz0_123",cr="_previewValue_13uz0_130",ur="_error_13uz0_137",ie={panel:Jo,summaryCard:Qo,summaryLabel:er,summaryValue:tr,summaryMeta:nr,editor:ir,fieldLabel:or,dateInput:rr,helperRow:ar,helperButton:sr,preview:lr,previewLabel:dr,previewValue:cr,error:ur};var vr=L("<button>Adjust"),mr=L("<div><p>Preview</p><p>"),hr=L("<p>"),fr=L("<div><div><div><button type=button>Cancel</button><h4>Adjust original date</h4><button type=button></button></div><div><div><div>Current capture date</div><p></p><p>Timezone: </p></div><div><label for=adjust-date-input>New date &amp; time</label><input id=adjust-date-input type=datetime-local><div><button type=button>Use upload date</button><button type=button>Now");const Tt=()=>({showAdjust:!1,pendingDate:"",adjustError:"",savingDate:!1}),gr=e=>{const[t,i]=le(Tt()),{setDisplayMedia:o}=ee(),{items:n}=oe(),d=Intl.DateTimeFormat().resolvedOptions().timeZone,g=F(()=>{const h=t.pendingDate;if(!h)return"";const l=new Date(h);return Number.isNaN(l.getTime())?"":l.toISOString()}),r=F(()=>{const h=Lt(g()),l=Lt(e.mediaInfo.create_date);return Number.isFinite(h)&&Number.isFinite(l)&&h!==l}),c=F(()=>{const h=g();if(!h)return"";const l=De(h);return typeof l=="string"?"":`${l.weekday} • ${l.date} • ${l.time}`}),p=()=>i("showAdjust",!0),v=()=>i(Tt());F(()=>{if(!t.showAdjust)return;const h=Je(e.mediaInfo.create_date)||Je(e.mediaInfo.upload_at)||new Date().toISOString();i({adjustError:"",savingDate:!1,pendingDate:kt(h)})});const y=h=>{const l=Je(h);l&&i("pendingDate",kt(l))},I=async()=>{const h=e.mediaInfo.media_id;if(!h)return alert("No valid photo/video to update date");const l=g();if(!l)return i("adjustError","Choose a valid date and time.");if(!r())return i("adjustError","Pick a different date before saving.");i({savingDate:!0,adjustError:""});const a=await fn(h,l);if(!a.ok){try{const u=await a.json();i("adjustError",u?.error||"Unable to update date.")}catch{i("adjustError","Unable to update date.")}i("savingDate",!1);return}o([...n().keys()],"create_date",l),e.setMediaInfo("create_date",l),v()};return[(()=>{var h=vr();return h.$$click=p,h})(),b(W,{get when(){return t.showAdjust},get children(){return b(Pe,{get children(){var h=fr(),l=h.firstChild,a=l.firstChild,u=a.firstChild,S=u.nextSibling,w=S.nextSibling,$=a.nextSibling,s=$.firstChild,M=s.firstChild,D=M.nextSibling,E=D.nextSibling;E.firstChild;var P=s.nextSibling,V=P.firstChild,T=V.nextSibling,O=T.nextSibling,U=O.firstChild,H=U.nextSibling;return u.$$click=v,w.$$click=I,_(w,()=>t.savingDate?"Saving...":"Save"),_(D,()=>e.displayTime||"Unknown date"),_(E,d,null),T.$$input=k=>i("pendingDate",k.currentTarget.value),U.$$click=()=>y(e.mediaInfo.upload_at),H.$$click=()=>y(new Date().toISOString()),_(P,b(W,{get when(){return c()},get children(){var k=mr(),R=k.firstChild,Y=R.nextSibling;return _(Y,c),N(A=>{var m=ie.preview,x=ie.previewLabel,z=ie.previewValue;return m!==A.e&&f(k,A.e=m),x!==A.t&&f(R,A.t=x),z!==A.a&&f(Y,A.a=z),A},{e:void 0,t:void 0,a:void 0}),k}}),null),_(P,b(W,{get when(){return t.adjustError},get children(){var k=hr();return _(k,()=>t.adjustError),N(()=>f(k,ie.error)),k}}),null),N(k=>{var R=j.backdrop,Y=`${j.sheet} ${me.infoSheet}`,A=`${j.header} ${ie.header}`,m=`${j.headerButton} ${ie.headerButton}`,x=`${j.headerTitle} ${ie.headerTitle}`,z=`${j.headerButton} ${ie.headerButton}`,B=!r()||t.savingDate,C=`${me.mediaInfo} ${ie.panel}`,G=ie.summaryCard,X=ie.summaryLabel,J=ie.summaryValue,ne=ie.summaryMeta,re=ie.editor,ue=ie.fieldLabel,ae=ie.dateInput,ye=ie.helperRow,Ie=ie.helperButton,ke=ie.helperButton;return R!==k.e&&f(h,k.e=R),Y!==k.t&&f(l,k.t=Y),A!==k.a&&f(a,k.a=A),m!==k.o&&f(u,k.o=m),x!==k.i&&f(S,k.i=x),z!==k.n&&f(w,k.n=z),B!==k.s&&(w.disabled=k.s=B),C!==k.h&&f($,k.h=C),G!==k.r&&f(s,k.r=G),X!==k.d&&f(M,k.d=X),J!==k.l&&f(D,k.l=J),ne!==k.u&&f(E,k.u=ne),re!==k.c&&f(P,k.c=re),ue!==k.w&&f(V,k.w=ue),ae!==k.m&&f(T,k.m=ae),ye!==k.f&&f(O,k.f=ye),Ie!==k.y&&f(U,k.y=Ie),ke!==k.g&&f(H,k.g=ke),k},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0}),N(()=>T.value=t.pendingDate),h}})}})]},kt=e=>{const t=Je(e);if(!t)return"";const i=new Date(t);return new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16)},Je=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString()},Lt=e=>{if(!e)return NaN;const t=new Date(e).getTime();return Number.isNaN(t)?NaN:Math.floor(t/6e4)};te(["click","input"]);var _r=L("<button type=button aria-label=Info>"),br=L("<p> FPS"),pr=L("<p>"),$r=L('<div style=background:none;backdrop-filter:none><div><div><div><input id=input-caption-media type=text autocomplete=off style=pointer-events:auto><div aria-label="Edit caption"></div></div><div><div></div></div><p></p><div><div><p></p><p></p></div><div><span></span><span></span></div><div></div><div><p>Posted: </p><p>By </p></div></div><div>');const wr=()=>{const{items:e}=oe();let t=null;const[i,o]=K(!0),[n,d]=le(Ir()),[g,r]=K(!1),c=l=>{l.currentTarget===l.target&&(l.preventDefault(),l.stopPropagation(),p())};F(()=>{typeof document>"u"||document.documentElement.classList.toggle("infoSheetOpen",g())}),Me(()=>{typeof document>"u"||document.documentElement.classList.remove("infoSheetOpen")});const p=()=>{r(!1),o(!0),t?.blur()},v=async()=>{await I()&&r(!0)},y=async()=>{if(i())o(!1),t?.focus();else{o(!0);const l=e().values().next().value;if(!l)return alert("No valid photo/video to update");if(!t||t.value.trim().length===0||t.value==="Add a Caption")return alert("Please enter new data to update this caption.");if(t.value.trim()===n.caption)return;const u=await gn(l,t.value);if(!u.ok)return console.log(await u.json());d("caption",t.value)}},I=async()=>{const l=e().values().next().value;if(!l)return alert("No valid photo/video to get info"),!1;if(n.media_id===l)return!0;const a=await _n(l);return a?(d(a),!0):(console.log("Missing info"),!1)};F(()=>{e()&&p()});const h=F(()=>{if(!n)return"";const l=De(n.create_date);return typeof l=="string"?l:`${l.weekday} • ${l.date} • ${l.time}`});return[(()=>{var l=_r();return l.$$click=v,_(l,Ln),l})(),b(W,{get when(){return g()},get children(){return b(Pe,{get children(){var l=$r(),a=l.firstChild,u=a.firstChild,S=u.firstChild,w=S.firstChild,$=w.nextSibling,s=S.nextSibling,M=s.firstChild,D=s.nextSibling,E=D.nextSibling,P=E.firstChild,V=P.firstChild,T=V.nextSibling,O=P.nextSibling,U=O.firstChild,H=O.nextSibling,k=H.nextSibling,R=k.firstChild;R.firstChild;var Y=R.nextSibling;Y.firstChild;var A=E.nextSibling;return l.$$click=c,he(m=>t=m,w),Q(w,"spellcheck",!1),$.$$click=y,_($,(()=>{var m=se(()=>!!i());return()=>m()?Xt():qt()})()),_(M,()=>h()||"Wednesday • Aug 8, 2012 • 2:55 PM {wrong}"),_(s,b(gr,{mediaInfo:n,setMediaInfo:d,get displayTime(){return h()}}),null),_(D,()=>n.file_name),_(V,(()=>{var m=se(()=>!!(n.make&&n.model));return()=>m()&&`${n.make} ${n.model}`||"UNKNOWN CAMERA"})()),_(T,()=>String(n.file_ext||n.mime_type||"").toUpperCase()||"FILE"),_(U,()=>n.lens_model||"No lens information"),_(H,(()=>{var m=se(()=>n.file_type!=="Photo");return()=>m()?`${yr(n)}P • `:""})(),null),_(H,(()=>{var m=se(()=>!!n.megapixels);return()=>m()?`${n.megapixels} MP • `:""})(),null),_(H,(()=>{var m=se(()=>!!n.image_height);return()=>m()?`${n.image_height} × ${n.image_width}`:"Video"})(),null),_(H,(()=>{var m=se(()=>!!lt(n.file_size));return()=>m()?` • ${lt(n.file_size)}`:""})(),null),_(k,b(W,{get when(){return n.frame_rate},get children(){var m=br(),x=m.firstChild;return _(m,()=>n.frame_rate,x),m}}),R),_(k,b(W,{get when(){return n.video_duration},get children(){var m=pr();return _(m,()=>n.video_duration),m}}),R),_(R,()=>De(n.upload_at,"date").toString(),null),_(Y,()=>n.user_name||"Unknown",null),_(A,(()=>{var m=se(()=>!!n.city);return()=>m()?`${n.city}, ${n.state}`:"Add a location ..."})()),N(m=>{var x=j.backdrop,z=`${j.sheet} ${me.infoSheet}`,B=me.mediaInfo,C=me.caption,G=i(),X=me.linkButton,J=me.dateInfo,ne=me.fileName,re=me.infoOfMedia,ue=me.cameraInfo,ae=me.addLocation;return x!==m.e&&f(l,m.e=x),z!==m.t&&f(a,m.t=z),B!==m.a&&f(u,m.a=B),C!==m.o&&f(S,m.o=C),G!==m.i&&(w.disabled=m.i=G),X!==m.n&&f($,m.n=X),J!==m.s&&f(s,m.s=J),ne!==m.h&&f(D,m.h=ne),re!==m.r&&f(E,m.r=re),ue!==m.d&&f(P,m.d=ue),ae!==m.l&&f(A,m.l=ae),m},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0}),N(()=>w.value=n.caption||"Add a Caption"),l}})}})]},yr=e=>{if(!e)return 0;const t=e.image_width,i=e.image_height;return!t||!i?0:Math.min(t,i)},Ir=()=>({caption:"",create_date:"",file_ext:0,file_name:"",file_size:0,file_type:"",city:"",state:"",make:"",media_id:0,mime_type:"",model:"",orientation:"",software:"",upload_at:"",user_name:"",image_height:0,image_width:0,lens_model:"",megapixels:"",title:"",frame_rate:0,video_duration:"",duration:0,source_file:"",favorite:!1,selected_frame:0,create_year:0,create_month:0,thumb_path:""});te(["click"]);var Sr=L("<button popovertarget=delete-all-contents>Delete All");const xr=()=>{const{items:e,setItems:t,setIsSelected:i}=oe(),{displayMedias:o,setDisplayMedia:n}=ee(),d="This will permanently delete all photo(s) & video(s) in Recently Deleted. This action can't be undone",g=async()=>{await bn(),n([]),i(!1),t(new Map),!(o.length>0)&&window.history.back()},r=()=>`Delete ${e().size<250?o.length:"All"} Photo(s)`;return[Sr(),b(tt,{idElement:"delete-all-contents",noticeText:d,confirmBtn:g,infoText:r})]};var Cr=L("<button popovertarget=merge-all-contents>Merge All");const Mr=()=>{const{items:e,setItems:t,setIsSelected:i}=oe(),{displayMedias:o,setDisplayMedia:n}=ee(),d="This will merges all duplicate photo(s) to one. This action can't be undone",g=async()=>{await pn(),n([]),i(!1),t(new Map),window.history.back()},r=()=>`Merge ${e().size<250?o.length:"All"} Photo(s)`;return[Cr(),b(tt,{idElement:"merge-all-contents",noticeText:d,confirmBtn:g,infoText:r})]};var Tr=L("<button>"),kr=L("<button inert style=pointer-events:none>"),Lr=L('<footer style=z-index:10><div class="actions__toolbar__column is_left"></div><div class="actions__toolbar__column is_middle"></div><div class="actions__toolbar__column is_right">');const Et=e=>({default:e?["save","favorite","info","edit","delete"]:["save","favorite","count","more","delete"],deleted:e?["recover","permanentDelete"]:["recover","count","permanentDelete","permanentDeleteAll"],hidden:e?["unhide","delete"]:["unhide","count","delete"],duplicate:e?["permanentDelete"]:["mergeAll","count","permanentDelete"]}),nn=()=>{const{items:e,setItems:t,setIsSelected:i}=oe(),o=ht(),{openModal:n,setOpenModal:d,displayMedias:g,setDisplayMedia:r}=ee(),c={delete:()=>p("deleted",!0),recovery:()=>p("deleted",!1),favorite:()=>p("favorite"),hide:()=>p("hidden",!0),unhide:()=>p("hidden",!1)},p=async(I,h)=>{if(e().size<1)return;const l=new Set(e().values()),a=new Set(e().keys());if(I==="favorite"){const S=[...a].some(w=>!g[w].favorite);h=S,r([...a],"favorite",S)}else r(S=>S.filter((w,$)=>!a.has($)));const u=await $n([...l],I,h);u.ok||console.error(`Failed to update ${I}:`,u),!n.isOpen&&(i(!1),t(new Map),!(g.length>0)&&window.history.back())},v=Et(n.isOpen)[o.pages]||Et(n.isOpen).default,y=()=>e().size<1;return(()=>{var I=Lr(),h=I.firstChild,l=h.nextSibling,a=l.nextSibling;return _(h,b(Qe,{get fallback(){return b(Do,{})},get children(){return[b(ge,{get when(){return v.includes("unhide")},get children(){return b(Vo,{get action(){return c.unhide}})}}),b(ge,{get when(){return v.includes("recover")},get children(){return b(Fo,{get action(){return c.recovery}})}})]}})),_(l,b(W,{get when(){return v.includes("favorite")},get children(){return b(Ii,{get action(){return c.favorite}})}}),null),_(l,b(W,{get when(){return v.includes("info")},get children(){return b(wr,{})}}),null),_(l,b(W,{get when(){return v.includes("edit")},get children(){var u=Tr();return u.$$click=()=>d("isEditing",!0),_(u,En),u}}),null),_(l,b(Qe,{get children(){return[b(ge,{get when(){return se(()=>!!v.includes("permanentDeleteAll"))()&&e().size===1},get children(){return b(xr,{})}}),b(ge,{get when(){return se(()=>!!v.includes("mergeAll"))()&&e().size===1},get children(){return b(Mr,{})}}),b(ge,{get when(){return v.includes("count")},get children(){var u=kr();return _(u,()=>e().size),u}})]}}),null),_(l,b(W,{get when(){return v.includes("more")},get children(){return b(To,{get hide(){return c.hide}})}}),null),_(a,b(jo,{get delete(){return c.delete},get isDeletePage(){return v.includes("delete")}})),N(u=>{var S=y(),w=`${y()?"footerDisabled":""}`,$=!v.includes("favorite")&&n.isOpen?"hidden":"visible";return S!==u.e&&(I.inert=u.e=S),w!==u.t&&f(I,u.t=w),$!==u.a&&de(l,"visibility",u.a=$),u},{e:void 0,t:void 0,a:void 0}),I})()};te(["click"]);var Er=L("<button style=padding-inline:20px;font-weight:600>");const Dr=()=>{const{setItems:e,isSelected:t,setIsSelected:i}=oe();return F(()=>{t()?document.querySelectorAll(".footer_nav").forEach(o=>{o.classList.add("hideFooter")}):(document.querySelectorAll(".footer_nav").forEach(o=>{o.classList.remove("hideFooter")}),e(new Map))}),(()=>{var o=Er();return o.$$click=()=>i(n=>!n),_(o,()=>t()?"Cancel":"Select"),o})()};te(["click"]);const Pr="_modalContainer_1lzmo_6",Ar="_modalTitle_1lzmo_18",Or="_modalImages_1lzmo_26",Br="_visualList_1lzmo_59",zr="_mediaContainer_1lzmo_65",Fr="_editButton_1lzmo_213",Nr="_finished_1lzmo_217",Vr="_canceled_1lzmo_223",_e={modalContainer:Pr,modalTitle:Ar,modalImages:Or,visualList:Br,mediaContainer:zr,editButton:Fr,finished:Nr,canceled:Vr},Rr="_overlayImg_mgf9x_2",jr="_videoPlayerContainer_mgf9x_76",Wr="_videoControler_mgf9x_92",Ur="_playInfo_mgf9x_113",Hr="_playbar_mgf9x_142",Zr="_videoSlider_mgf9x_179",Yr="_liveIcon_mgf9x_237",$e={overlayImg:Rr,videoPlayerContainer:jr,videoControler:Wr,playInfo:Ur,playbar:Hr,videoSlider:Zr,liveIcon:Yr};var Gr=L("<div style=z-index:1;background:transparent><header><button></button><button>");const _t=e=>b(Pe,{get children(){var t=Gr(),i=t.firstChild,o=i.firstChild,n=o.nextSibling;return Le(o,"click",e.onCancel,!0),_(o,Dn),_(i,()=>e.dropdown,n),Le(n,"click",e.onDone,!0),_(n,qt),_(t,()=>e.children,null),N(d=>{var g=_e.modalContainer,r=`${_e.editButton} ${_e.canceled}`,c=`${_e.editButton} ${_e.finished}`;return g!==d.e&&f(t,d.e=g),r!==d.t&&f(o,d.t=r),c!==d.a&&f(n,d.a=c),d},{e:void 0,t:void 0,a:void 0}),t}});te(["click"]);var Xr=L("<div style=color:white>"),qr=L('<footer class=footer_nav><div class="actions__toolbar__column is_left"><button>A</button></div><div class="actions__toolbar__column is_middle"><button>Reduce Frames</button></div><div class="actions__toolbar__column is_right"><button>B');const Kr=e=>{const{openModal:t,setOpenModal:i}=ee(),o=()=>e.media,n=()=>e.video,d=()=>i("isEditing",!1),g=()=>{i("isEditing",!1)};F(()=>{t.isEditing&&(n()&&!n().paused&&n().pause(),i("showImage",!0))});const r=async()=>{console.log("reducing frame")};return b(_t,{onCancel:d,onDone:g,get children(){return[Xr(),(()=>{var c=qr(),p=c.firstChild,v=p.nextSibling,y=v.firstChild;return y.$$click=r,N(()=>y.disabled=o().frame_rate<=30),c})()]}})};te(["click"]);var Jr=L("<video preload=none controlslist=nodownload playsinline crossorigin=use-credentials><source><p>Your browser doesn't support the video tag."),Qr=L('<img inert loading=lazy decoding=async alt="Video placeholder">',!0,!1,!1),ea=L("<div><div><button></button><p></p><button></button></div><div><input type=range min=0 step=0.01>"),ta=L('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"><path d="M16.658 9.286c1.44.9 2.16 1.35 2.407 1.926a2 2 0 0 1 0 1.576c-.247.576-.967 1.026-2.407 1.926L9.896 18.94c-1.598.999-2.397 1.498-3.056 1.445a2 2 0 0 1-1.446-.801C5 19.053 5 18.111 5 16.226V7.774c0-1.885 0-2.827.394-3.358a2 2 0 0 1 1.446-.801c.66-.053 1.458.446 3.056 1.445l6.762 4.226Z">'),na=L('<svg xmlns=http://www.w3.org/2000/svg viewBox="-0.5 0 25 25"><path stroke-width=0.1 d="M10 6.42a3 3 0 0 0-6 0v12a3 3 0 1 0 6 0v-12ZM20 6.42a3 3 0 1 0-6 0v12a3 3 0 1 0 6 0v-12Z">'),ia=L('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"><path stroke-width=2 d="M3 8.5a.5.5 0 0 1-1 0v-2A2.5 2.5 0 0 1 4.5 4h2a.5.5 0 0 1 0 1h-2A1.5 1.5 0 0 0 3 6.5v2ZM17.5 5a.5.5 0 1 1 0-1h2A2.5 2.5 0 0 1 22 6.5v2a.5.5 0 1 1-1 0v-2A1.5 1.5 0 0 0 19.5 5h-2ZM21 15.5a.5.5 0 1 1 1 0v2a2.5 2.5 0 0 1-2.5 2.5h-2a.5.5 0 1 1 0-1h2a1.5 1.5 0 0 0 1.5-1.5v-2ZM6.5 19a.5.5 0 1 1 0 1h-2A2.5 2.5 0 0 1 2 17.5v-2a.5.5 0 1 1 1 0v2A1.5 1.5 0 0 0 4.5 19h2Z">');const oa=e=>{const t=()=>e.media,i=()=>e.isVisible,o=()=>e.childDim,{openModal:n}=ee(),{view:d}=ve(),g=F(()=>i()&&r);let r;const[c,p]=le({isLoading:!0,isPlaying:!1,currentTime:0,muted:!1,isFullScreen:!1}),v=F(()=>n.transitionPhase==="opening"&&n.transitionMediaId===t().media_id);F(async()=>{if(!v()){if(!g())return r&&!r.paused?r.pause():void 0;!d.autoplay||!r||r.paused&&Dt(r)}});const y=F(()=>n.transitionMediaId===t().media_id?nt:i()?"active-media":""),I=F(()=>v()?"":y());return[(()=>{var h=Jr(),l=h.firstChild;return h.addEventListener("timeupdate",a=>p("currentTime",a.currentTarget.currentTime)),h.addEventListener("pause",()=>{p("isPlaying",!1)}),h.addEventListener("play",a=>{a.preventDefault(),p("isPlaying",!0)}),h.addEventListener("loadeddata",()=>p("isLoading",!1)),h.addEventListener("load",()=>p("isLoading",!0)),h.addEventListener("fullscreenchange",()=>p("isFullScreen",a=>!a)),he(a=>r=a,h),h.controls=!1,N(a=>{var u={...o(),"view-transition-name":I(),opacity:v()?0:1,transition:v()?"none":void 0},S=!c.isFullScreen,w=c.muted,$=`${Ut}${t().source_file}`,s=t().mime_type;return a.e=Te(h,u,a.e),S!==a.t&&(h.inert=a.t=S),w!==a.a&&(h.muted=a.a=w),$!==a.o&&Q(l,"src",a.o=$),s!==a.i&&Q(l,"type",a.i=s),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),h})(),b(W,{get when(){return v()},get children(){var h=Qr();return N(l=>{var a=$e.overlayImg,u={...o(),"view-transition-name":y()},S=t().thumb_path;return a!==l.e&&f(h,l.e=a),l.t=Te(h,u,l.t),S!==l.a&&Q(h,"src",l.a=S),l},{e:void 0,t:void 0,a:void 0}),h}}),b(W,{get when(){return se(()=>!!g())()&&!v()},get children(){var h=ea(),l=h.firstChild,a=l.firstChild,u=a.nextSibling,S=u.nextSibling,w=l.nextSibling,$=w.firstChild;return a.$$click=async()=>Dt(r),_(a,(()=>{var s=se(()=>!!c.isPlaying);return()=>s()?ua():ca()})()),_(u,()=>la(c.currentTime)),S.$$click=s=>da(s,r),_(S,va),$.addEventListener("pointercancel",s=>s.stopPropagation()),$.$$pointermove=s=>s.stopPropagation(),$.$$pointerup=s=>{s.stopPropagation(),sa(r)},$.$$pointerdown=s=>{s.stopPropagation(),aa(r)},Le($,"input",ra(p,()=>r),!0),N(s=>{var M={[$e.videoPlayerContainer]:!0,fadeOut:n.showImage,[$e.videoControler]:!0},D=$e.playInfo,E=$e.playbar,P=$e.videoSlider,V=`${c.currentTime/t().duration*100}%`,T=Math.round(t().duration*100)/100;return s.e=He(h,M,s.e),D!==s.t&&f(l,s.t=D),E!==s.a&&f(w,s.a=E),P!==s.o&&f($,s.o=P),V!==s.i&&de($,"--currentProcess",s.i=V),T!==s.n&&Q($,"max",s.n=T),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),N(()=>$.value=c.currentTime),h}}),b(W,{get when(){return se(()=>!!(n.isEditing&&g()))()&&!v()},get children(){return b(Kr,{video:r,get media(){return t()}})}})]},ra=(e,t)=>i=>{i.preventDefault(),i.stopPropagation();const o=Number(i.currentTarget.value),n=t();n&&(n.currentTime=o,e("currentTime",o))},aa=e=>{e&&(e.paused||e.pause())},sa=e=>{e&&e.paused&&e.play()};function la(e){if(!Number.isFinite(e))return"00:00";const t=Math.max(0,Math.round(e)),i=Math.floor(t/3600),o=Math.floor(t%3600/60),n=t%60,d=String(o).padStart(2,"0"),g=String(n).padStart(2,"0");return i>0?`${String(i).padStart(2,"0")}:${d}:${g}`:`${d}:${g}`}const Dt=e=>{if(e)return e.readyState<3&&e.load(),e.paused?e.play().catch(t=>console.warn("Autoplay blocked",t)):e.pause()},da=(e,t)=>{e.preventDefault(),t&&(t.requestFullscreen?t.requestFullscreen():t.webkitEnterFullscreen())},ca=()=>ta(),ua=()=>na(),va=()=>ia();te(["click","input","pointerdown","pointerup","pointermove"]);const ma="_mainBrusher_1s8h0_1",ha="_inputBrusher_1s8h0_18",fa="_sizeBrusher_1s8h0_40",rt={mainBrusher:ma,inputBrusher:ha,sizeBrusher:fa};var ga=L("<div><canvas>"),_a=L("<div><div><label for=brushSize>Size</label><span>px</span></div><input id=brushSize type=range>"),ba=L('<footer class=footer_nav><div class="actions__toolbar__column is_left"><button></button></div><div class="actions__toolbar__column is_middle"><button> Remove</button></div><div class="actions__toolbar__column is_right"><button>');const et={min:1,max:300},pa=e=>{const[t,i]=K(!1),[o,n]=K(50),[d,g]=le({x:0,y:0});let r,c;const p=l=>{const a=r.getBoundingClientRect(),u=r.width/a.width,S=r.height/a.height;return{x:(l.clientX-a.left)*u,y:(l.clientY-a.top)*S}};be(()=>{r.width=e.photo.naturalWidth,r.height=e.photo.naturalHeight,r.width>=r.height?(r.style.width="100%",r.style.height="auto"):(r.style.width="auto",r.style.height="100%");const l=r.getContext("2d");l&&(l.lineJoin="round",l.lineCap="round",l.lineWidth=o(),l.strokeStyle="white",c=l)});const v=l=>{i(!0);const a=p(l);g({x:a.x,y:a.y})},y=()=>{i(!1)},I=l=>{if(!t()||!c)return;const a=p(l);c.lineWidth=o(),c.beginPath(),c.moveTo(d.x,d.y),c.lineTo(a.x,a.y),c.stroke(),c.closePath(),g({x:a.x,y:a.y})},h=()=>{c&&c.clearRect(0,0,r.width,r.height)};return Me(()=>{c&&c.closePath()}),[(()=>{var l=ga(),a=l.firstChild;return a.$$mouseup=y,a.$$mousemove=I,a.$$mousedown=v,he(u=>r=u,a),N(()=>f(l,rt.mainBrusher)),l})(),b(W,{get when(){return!t()},get children(){return[(()=>{var l=_a(),a=l.firstChild,u=a.firstChild,S=u.nextSibling,w=S.firstChild,$=a.nextSibling;return _(S,o,w),$.$$input=s=>n(Number(s.target.value)),N(s=>{var M=rt.inputBrusher,D=rt.sizeBrusher,E=$a(o()),P=et.min,V=et.max;return M!==s.e&&f(l,s.e=M),D!==s.t&&f(a,s.t=D),E!==s.a&&de($,"background",s.a=E),P!==s.o&&Q($,"min",s.o=P),V!==s.i&&Q($,"max",s.i=V),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),N(()=>$.value=o()),l})(),(()=>{var l=ba(),a=l.firstChild,u=a.firstChild,S=a.nextSibling,w=S.firstChild,$=w.firstChild,s=S.nextSibling,M=s.firstChild;return _(u,Pn),w.$$click=()=>{},_(w,Xt,$),M.$$click=h,_(M,An),l})()]}})]},$a=e=>{const t=et.min,i=et.max,o=(e-t)/(i-t)*100;return`linear-gradient(to right, var(--button-active-color) 0%, var(--button-active-color) ${o}%, #ccc ${o}%, #ccc 100%)`};te(["mousedown","mousemove","mouseup","input","click"]);const wa="_dropdownWrapper_15cn4_1",ya="_customSelect_15cn4_6",Pt={dropdownWrapper:wa,customSelect:ya};var Ia=L("<div><select><option value=remove>Erase Unwanted</option><option value=replace>Replace Object</option><option value=generate>Generate Photos");const Sa=()=>{const[e,t]=K("remove");return(()=>{var i=Ia(),o=i.firstChild;return o.$$input=n=>t(n.currentTarget.value),N(n=>{var d=Pt.dropdownWrapper,g=Pt.customSelect;return d!==n.e&&f(i,n.e=d),g!==n.t&&f(o,n.t=g),n},{e:void 0,t:void 0}),N(()=>o.value=e()),i})()};te(["input"]);const xa=e=>{const{setOpenModal:t}=ee(),i=()=>t("isEditing",!1),o=()=>{t("isEditing",!1)},{setView:n}=ve();return be(()=>n("modalObjFit",!0)),b(_t,{onCancel:i,onDone:o,get dropdown(){return Sa()},get children(){return b(pa,{get photo(){return e.photo}})}})};var Ca=L('<img inert loading=lazy alt="Modal Image">',!0,!1,!1),Ma=L('<img inert loading=lazy decoding=async alt="Modal Image Placeholder">',!0,!1,!1);const Ta=e=>{const t=()=>e.media,i=()=>e.isVisible,o=()=>e.childDim;let n;const{openModal:d}=ee(),g=F(()=>d.transitionMediaId===t().media_id?nt:i()?"active-media":""),r=F(()=>d.transitionPhase==="opening"&&d.transitionMediaId===t().media_id),c=F(()=>r()?"":g());return[(()=>{var p=Ca();return he(v=>n=v,p),N(v=>{var y={...o(),"view-transition-name":c(),opacity:r()?0:1,transition:r()?"none":void 0},I=t().source_file;return v.e=Te(p,y,v.e),I!==v.t&&Q(p,"src",v.t=I),v},{e:void 0,t:void 0}),p})(),b(W,{get when(){return r()},get children(){var p=Ma();return N(v=>{var y=$e.overlayImg,I={...o(),"view-transition-name":g()},h=t().thumb_path;return y!==v.e&&f(p,v.e=y),v.t=Te(p,I,v.t),h!==v.a&&Q(p,"src",v.a=h),v},{e:void 0,t:void 0,a:void 0}),p}}),b(W,{get when(){return d.isEditing&&i()&&n},get children(){return b(xa,{photo:n})}})]},ka="_modalThumbs_gqgfp_2",La="_modalThumbsRail_gqgfp_17",Ea="_smallThumbs_gqgfp_51",Ee={modalThumbs:ka,modalThumbsRail:La,smallThumbs:Ea},Da="_bgThumbs_1w6c7_2",Pa="_inputSlider_1w6c7_11",Aa="_onloadSlider_1w6c7_38",at={bgThumbs:Da,inputSlider:Pa,onloadSlider:Aa};var Oa=L("<div style=margin-bottom:5px><div><input type=range min=0 step=any>"),Ba=L("<div><img inert>");const At=50,za=11,Fa=e=>{const t=()=>e.currentChild,i=()=>e.media,o=()=>e.isLoading,[n,d]=K([]),[g,r]=K(i().selected_frame),{setOpenModal:c}=ee();be(async()=>{e.setIsLoading(!0),await Na(t(),d),await ut(t(),i().selected_frame),e.setIsLoading(!1)});const p=async h=>{await ut(t(),h),r(h)},{items:v}=oe(),{setDisplayMedia:y}=ee();return b(_t,{onCancel:()=>c("isEditing",!1),onDone:async()=>{(await wn(i().media_id,g())).ok||alert("Failed to update frame position"),y([...v().keys()],"selected_frame",g()),c("isEditing",!1)},get children(){var h=Oa(),l=h.firstChild,a=l.firstChild;return _(l,b(Ht,{get each(){return n()},children:u=>(()=>{var S=Ba(),w=S.firstChild;return N($=>{var s=Ee.smallThumbs,M=u().imageBase;return s!==$.e&&f(S,$.e=s),M!==$.t&&Q(w,"src",$.t=M),$},{e:void 0,t:void 0}),S})()}),a),a.$$input=u=>{u.preventDefault(),p(parseFloat(u.currentTarget.value))},N(u=>{var S=Ee.modalThumbs,w=`${Ee.modalThumbsRail} ${at.bgThumbs}`,$={[at.inputSlider]:!0,[at.onloadSlider]:o()},s=i().duration;return S!==u.e&&f(h,u.e=S),w!==u.t&&f(l,u.t=w),u.a=He(a,$,u.a),s!==u.o&&Q(a,"max",u.o=s),u},{e:void 0,t:void 0,a:void 0,o:void 0}),N(()=>a.value=g()),h}})},Na=async(e,t)=>{if(!e||!e.readyState)return;const i=e.videoWidth/e.videoHeight,o=document.createElement("canvas"),n=o.getContext("2d"),d=e.duration,g=d/za,r=[];o.height=At,o.width=At*i;for(let c=g;c<d;c+=g){await ut(e,c),n?.drawImage(e,0,0,o.width,o.height);const p=o.toDataURL("image/jpeg");r.push({imageBase:p,position:c})}t(r)};function ut(e,t){return new Promise(i=>{const o=()=>{e.removeEventListener("seeked",o),i()};e.addEventListener("seeked",o),e.currentTime=t})}te(["input"]);var Va=L("<video inert controlslist=nodownload preload=none crossorigin=use-credentials><source><p>Your browser doesn't support the video tag."),Ra=L("<div><span>LIVE"),ja=L('<img inert loading=lazy decoding=async alt="Live placeholder">',!0,!1,!1);const Wa=e=>{const t=()=>e.media,i=()=>e.isVisible,o=()=>e.childDim,{view:n}=ve(),{openModal:d,setOpenModal:g}=ee();let r;const c=F(()=>i()&&r),p=e.clickableArea,[v,y]=K(!0),I=F(()=>d.transitionPhase==="opening"&&d.transitionMediaId===t().media_id);F(async()=>{if(!c()||I()){y(!0);return}r.load(),y(!1)});const{pressed:h}=hi({target:p});let l;F(()=>{!c()||!r||n.zoomLevel>1||I()||(h()&&(l=setTimeout(async()=>(g("showImage",!0),await Rn(r)),200)),h()||(clearTimeout(l),r.paused||r.pause()))});const a=w=>{Ot(w,r,t().selected_frame)},u=F(()=>d.transitionMediaId===t().media_id?nt:i()?"active-media":""),S=F(()=>I()?"":u());return[(()=>{var w=Va(),$=w.firstChild;return w.addEventListener("pause",s=>a(s)),w.addEventListener("play",s=>Ot(s,r,0)),w.addEventListener("loadeddata",s=>a(s)),w.addEventListener("load",()=>y(!0)),he(s=>r=s,w),w.controls=!1,w.playsInline=!0,N(s=>{var M={...o(),"view-transition-name":S(),opacity:I()?0:1,transition:I()?"none":void 0},D=`${Ut}${t().source_file}`,E=t().mime_type;return s.e=Te(w,M,s.e),D!==s.t&&Q($,"src",s.t=D),E!==s.a&&Q($,"type",s.a=E),s},{e:void 0,t:void 0,a:void 0}),w})(),b(W,{get when(){return!d.showImage},get children(){var w=Ra(),$=w.firstChild;return _(w,On,$),N(()=>f(w,$e.liveIcon)),w}}),b(W,{get when(){return I()},get children(){var w=ja();return N($=>{var s=$e.overlayImg,M={...o(),"view-transition-name":u()},D=t().thumb_path;return s!==$.e&&f(w,$.e=s),$.t=Te(w,M,$.t),D!==$.a&&Q(w,"src",$.a=D),$},{e:void 0,t:void 0,a:void 0}),w}}),b(W,{get when(){return se(()=>!!d.isEditing)()&&c()},get children(){return b(Fa,{get media(){return t()},currentChild:r,get isLoading(){return v()},setIsLoading:y})}})]},Ot=(e,t,i)=>{t&&(e.preventDefault(),t.currentTime=i)};function Ua(e){const{view:t,setView:i}=ve();let o=0;const{mouseGesture:n,setMouseGesture:d,resetMouse:g,translate:r}=ee(),c=(a,u)=>Math.hypot(u.clientX-a.clientX,u.clientY-a.clientY),p=(a,u)=>({x:(a.clientX+u.clientX)/2,y:(a.clientY+u.clientY)/2}),v=a=>a instanceof MouseEvent?{x:a.clientX,y:a.clientY}:a.touches[0]?{x:a.touches[0].clientX,y:a.touches[0].clientY}:null,y=()=>{g(),o=0},I=a=>{const u=v(a);u&&"touches"in a&&a.touches.length===2&&(o=c(a.touches[0],a.touches[1]),d({action:"pinchZoom",status:!0,start:{x:u.x-r.x,y:u.y-r.y}}))},h=a=>{if(!(!v(a)||!o)&&n.action==="pinchZoom"&&"touches"in a&&a.touches.length===2){const S=c(a.touches[0],a.touches[1]),w=S-o,$=p(a.touches[0],a.touches[1]),s=w/o*sn,M=t.zoomLevel,D=Math.min(Math.max(M*(1+s),Zt),Yt);if(D!==M){const E=e.getBoundingClientRect(),P=$.x-E.left+e.scrollLeft,V=$.y-E.top+e.scrollTop,T=D/M,O=P*T-($.x-E.left),U=V*T-($.y-E.top);i("zoomLevel",D),requestAnimationFrame(()=>{e.scrollLeft=Math.max(0,O),e.scrollTop=Math.max(0,U)})}o=S}},l=()=>{n.action==="pinchZoom"&&y()};be(()=>{if(!e)return;const a={passive:!1};e.addEventListener("touchstart",I,a),e.addEventListener("touchmove",h,a),e.addEventListener("touchend",l,a),e.addEventListener("touchcancel",l,a),e.addEventListener("mousedown",I,a),e.addEventListener("mousemove",h,a),e.addEventListener("mouseup",l,a),e.addEventListener("mouseleave",l,a),Me(()=>{e.removeEventListener("touchstart",I),e.removeEventListener("touchmove",h),e.removeEventListener("touchend",l),e.removeEventListener("touchcancel",l),e.removeEventListener("mousedown",I),e.removeEventListener("mousemove",h),e.removeEventListener("mouseup",l),e.removeEventListener("mouseleave",l)})})}var Ha=L("<div style=top:0px>"),Za=L("<div>Unknown type");const Ya=240,Ga=100,Bt=0,zt=100,Xa=e=>{let t;const i=()=>e.media,o=()=>e.viewIndex,{view:n,setView:d}=ve(),{openModal:g,setOpenModal:r}=ee(),[c,p]=K(!1),[v,y]=le({x:0,y:0}),[I,h]=K(!1);let l=null,a=!1,u=0,S=0,w=0,$=0,s=null,M=0;const D=()=>n.zoomLevel<=1&&!g.isEditing,E=qa(n,d,c,g,r,()=>t),P=F(()=>n.zoomLevel>1?"auto":I()?"none":"pan-x"),V=F(()=>{const{x:m,y:x}=v,z=x?Math.max(.6,1-x/800):1,B=Math.max(-zt,Math.min(zt,m));return e.setStyleStore("bgOpacity",1-x/800),{transform:`translate3d(${B}px, ${x}px, 0) scale(${z})`,"transform-origin":"center center","will-change":"transform",transition:I()?"none":v.y===0?"transform 160ms ease-out":void 0}}),T=(m,x)=>{M&&cancelAnimationFrame(M),M=requestAnimationFrame(()=>{y({x:m,y:Math.max(0,x)})})},O=(m,x)=>{M&&cancelAnimationFrame(M),M=0;try{t?.releasePointerCapture(m.pointerId)}catch{}a=!1,l=null;const z=v.y;if(h(!1),x&&z>Ga){e.closeModal();return}y({x:0,y:0}),s!==null&&r("showImage",s),s=null,t&&t.scrollTo({left:w,top:$,behavior:"auto"})},U=m=>{!D()||!m.isPrimary||(a=!0,l=m.pointerId,u=m.clientX,S=m.clientY,s=g.showImage,w=t?.scrollLeft??0,$=t?.scrollTop??0,h(!1))},H=m=>{if(!a||l!==m.pointerId||n.zoomLevel>1)return;const x=m.clientX-u,z=m.clientY-S;if(!I()){const B=Math.abs(x),C=Math.abs(z);if(C<Bt&&B<Bt||B>C)return;h(!0),r("showImage",!0);try{t?.setPointerCapture(m.pointerId)}catch{}}I()&&m.cancelable&&m.preventDefault(),T(x,z)},k=m=>{!a||l!==m.pointerId||O(m,!0)},R=m=>{!a||l!==m.pointerId||O(m,!1)},Y=m=>{m.target===m.currentTarget&&(I()||v.x!==0||v.y!==0||E(m))};be(()=>{if(!t)return;const m=new IntersectionObserver(([G])=>{const X=G.isIntersecting;p(X),X&&(e.setSelectCurrentItem(o(),i().media_id),e.setLastEl&&e.setLastEl(t),z&&document.documentElement.style.setProperty("--modal-center","center"))},{threshold:.59});m.observe(t);const x=t.firstElementChild;let z=null;const B=x&&new ResizeObserver(([G])=>{const X=G.contentRect.height,J=n.zoomLevel>1&&X>window.innerHeight?"none":"center";J!==z&&(z=J,requestAnimationFrame(()=>{document.documentElement.style.setProperty("--modal-center",J)}))});x&&B&&B.observe(x);const C=Ua(t);typeof C=="function"&&Me(C),Me(()=>{m.disconnect(),B?.disconnect(),M&&cancelAnimationFrame(M)})});const A=F(()=>{if(!c()||n.zoomLevel<=1)return{};const m=window.innerWidth<window.innerHeight,z=vt(n.zoomLevel)*100,B=n.zoomLevel===1?"100dvw":"none";return m?{width:`${z}%`,height:"auto","max-width":B}:{width:"auto",height:`${z}%`,"max-width":B}});return F(()=>e.setStyleStore("overflowX",v.y>0)),(()=>{var m=Ha();return m.$$click=x=>Y(x),m.addEventListener("pointercancel",R),m.$$pointerup=k,m.$$pointermove=H,m.$$pointerdown=U,he(x=>t=x,m),_(m,b(Qe,{get fallback(){return Za()},get children(){return[b(ge,{get when(){return i().file_type==="Photo"},get children(){return b(Ta,{get media(){return i()},get isVisible(){return c()},get childDim(){return A()}})}}),b(ge,{get when(){return i().file_type==="Video"},get children(){return b(oa,{get media(){return i()},get isVisible(){return c()},get childDim(){return A()}})}}),b(ge,{get when(){return i().file_type==="Live"},get children(){return b(Wa,{get media(){return i()},get isVisible(){return c()},clickableArea:t,get childDim(){return A()}})}})]}})),N(x=>{var z=_e.mediaContainer,B={left:`${e.leftPos}px`,overflow:n.zoomLevel>1?"auto":"hidden","touch-action":P(),...V()},C=i().media_id;return z!==x.e&&f(m,x.e=z),x.t=Te(m,B,x.t),C!==x.a&&Q(m,"data-modalid",x.a=C),x},{e:void 0,t:void 0,a:void 0}),m})()},vt=e=>e<=1?1:1+.75*(e-1),qa=(e,t,i,o,n,d)=>{let g=null;const r=c=>{if(!o.isEditing){if(c.preventDefault(),c.stopPropagation(),g){if(clearTimeout(g),g=null,!i())return;const p=d();if(!p)return;const v=p.getBoundingClientRect(),y=c.clientX-v.left,I=c.clientY-v.top,h=y+p.scrollLeft,l=I+p.scrollTop,a=e.zoomLevel||1,u=a>1?1:4,S=vt(a),$=vt(u)/S,s=document.startViewTransition?.bind(document);if(!s){t("zoomLevel",u);return}s(()=>{t("zoomLevel",u)}).updateCallbackDone.then(()=>{requestAnimationFrame(()=>{const D=d();if(!D)return;if(u<=1){D.scrollTo({left:0,top:0});return}const E=h*$-y,P=l*$-I,V=Math.max(0,D.scrollWidth-D.clientWidth),T=Math.max(0,D.scrollHeight-D.clientHeight);D.scrollTo({left:Math.min(V,Math.max(0,E)),top:Math.min(T,Math.max(0,P)),behavior:"auto"})})});return}c.target===c.currentTarget&&(g=setTimeout(()=>{n("showImage",p=>!p),g=null},Ya))}};return Me(()=>{g&&clearTimeout(g)}),r};te(["pointerdown","pointermove","pointerup","click"]);var Ka=L('<header style=z-index:2><div class=buttonContainer><button></button></div><div><p></p><p style=font-size:12px></p></div><div class=buttonContainer><button popovertarget=more-modal-popover></button><div popover=auto id=more-modal-popover class="popover-container devices_filter_popover"><div class=media_type_contents><button></button><span>Zoom</span><button></button></div><div>Video Autoplay ');const Ja=e=>{const{view:t,setView:i}=ve(),{openModal:o,displayMedias:n}=ee(),d=r=>{i("zoomLevel",c=>c+r)},g=F(()=>{const r=n[e.currentIdx()];if(!r)return{date:"",time:""};const c=De(r.create_date,"date").toString(),p=De(r.create_date,"time").toString();return{date:c,time:p}});return(()=>{var r=Ka(),c=r.firstChild,p=c.firstChild,v=c.nextSibling,y=v.firstChild,I=y.nextSibling,h=v.nextSibling,l=h.firstChild,a=l.nextSibling,u=a.firstChild,S=u.firstChild,w=S.nextSibling,$=w.nextSibling,s=u.nextSibling;return s.firstChild,p.$$click=()=>{window.history.back()},_(p,Bn),_(y,()=>g().date),_(I,()=>g().time),_(l,zn),S.$$click=()=>d(1),_(S,ft),$.$$click=()=>d(-1),_($,Kt),s.$$click=()=>i("autoplay",M=>!M),_(s,()=>t.autoplay?"[ON]":"[OFF]",null),N(M=>{var D={fadeOut:o.showImage},E=_e.modalTitle,P=t.zoomLevel>=Yt,V=t.zoomLevel<=Zt;return M.e=He(r,D,M.e),E!==M.t&&f(v,M.t=E),P!==M.a&&(S.disabled=M.a=P),V!==M.o&&($.disabled=M.o=V),M},{e:void 0,t:void 0,a:void 0,o:void 0}),r})()};te(["click"]);var Qa=L("<div><div>"),es=L("<button type=button><img decoding=async loading=lazy alt>",!0,!1,!1);const on=9,ts=e=>{const{openModal:t,displayMedias:i}=ee(),{view:o}=ve(),n=F(()=>is(i,e.currentElId,on));return(()=>{var d=Qa(),g=d.firstChild;return d.inert=!0,_(g,b(Ht,{get each(){return n().items},get fallback(){return b(Gt,{})},children:r=>{const c=()=>r().media_id===e.currentElId;return(()=>{var p=es(),v=p.firstChild;return p.$$click=()=>{console.log("Thumbnail clicked:",r().media_id)},N(y=>{var I=Ee.smallThumbs,h=c(),l=c(),a=r().thumb_path;return I!==y.e&&f(p,y.e=I),h!==y.t&&Q(p,"data-selected",y.t=h),l!==y.a&&Q(p,"aria-selected",y.a=l),a!==y.o&&Q(v,"src",y.o=a),y},{e:void 0,t:void 0,a:void 0,o:void 0}),p})()}})),N(r=>{var c={[Ee.modalThumbs]:!0,fadeOut:t.showImage||!o.showThumb||i.length<=1},p=Ee.modalThumbsRail;return r.e=He(d,c,r.e),p!==r.t&&f(g,r.t=p),r},{e:void 0,t:void 0}),d})()},ns=(e,t,i)=>Math.min(Math.max(e,t),i),is=(e,t,i=on)=>{const o=e.length;if(o===0)return{items:[],startIndex:0,currentIndex:-1};const n=e.findIndex(y=>y.media_id===t),d=n>=0?n:0;if(o<=i)return{items:e.map((y,I)=>({...y,globalIndex:I})),startIndex:0,currentIndex:d};const g=Math.floor(i/2),r=o-i,c=ns(d-g,0,r),p=c+i;return{items:e.slice(c,p).map((y,I)=>({...y,globalIndex:c+I})),startIndex:c,currentIndex:d}};te(["click"]);var os=L("<div style=z-index:1><div id=modalImages><div></div></div><div>");const rs=3,as=150,xe=window.innerWidth+as,ss=xe*rs,ls=Math.ceil(ss/xe)+2,ds=e=>{const{openModal:t,setOpenModal:i,resetModal:o,displayMedias:n}=ee(),{items:d,setItems:g,setOneItem:r}=oe(),{setView:c}=ve(),p=E=>{cs(h),E&&It(E,"nearest"),o(t),g(new Map)},v=E=>{const P=y.elId,V=document.startViewTransition?.bind(document);if(!P||!V)return;const T=document.documentElement;i({transitionMediaId:P,transitionPhase:"closing"}),T.classList.add("vt-closing"),requestAnimationFrame(()=>{V(()=>{p(P)}).finished.finally(()=>{T.classList.remove("vt-closing"),o(),E||history.back()})})},[y,I]=le({elIndex:d().keys().next().value,elId:d().values().next().value});let h;const[l,a]=K(y.elIndex*xe),u=F(()=>Math.max(0,Math.floor(l()/xe)-1)),S=F(()=>Math.min(n.length-1,u()+ls)),w=F(()=>n.length===0?(window.history.back(),[]):n.slice(u(),S()+1));F(()=>{u()>=n.length-1&&a((n.length-1)*xe)}),be(()=>{jn(y.elId),window.onpopstate=()=>{t.isOpen&&v(!0)},vi(h,E=>{})});const $=(E,P)=>{I({elId:P,elIndex:E}),r(E,P)},s=E=>{E.preventDefault(),a(h.scrollLeft),It(y.elId,"nearest")};F(()=>{y.elId&&c("zoomLevel",1),document.documentElement.style.setProperty("--modal-center","center")});const[M,D]=le({bgOpacity:1,overflowX:!1});return b(Pe,{get children(){var E=os(),P=E.firstChild,V=P.firstChild,T=P.nextSibling;return _(E,b(Ja,{currentIdx:()=>y.elIndex}),P),P.addEventListener("scroll",s),he(O=>h=O,P),_(V,b(we,{get each(){return w()},children:(O,U)=>b(Xa,{get setLastEl(){return se(()=>n.length-1===u()+U())()?e.setLastEl:void 0},get leftPos(){return(u()+U())*xe},get viewIndex(){return u()+U()},media:O,setSelectCurrentItem:$,closeModal:v,setStyleStore:D})})),_(E,b(ts,{get currentElId(){return y.elId},itemWidth:xe,scrollRef:()=>h}),T),_(T,b(nn,{})),N(O=>{var U=_e.modalContainer,H=`rgba(19, 19, 20, ${M.bgOpacity})`,k=_e.modalImages,R=M.overflowX?"hidden":"scroll",Y=M.overflowX?"none":"x mandatory",A=_e.visualList,m=`${n.length*xe}px`,x={fadeOut:t.showImage};return U!==O.e&&f(E,O.e=U),H!==O.t&&de(E,"background",O.t=H),k!==O.a&&f(P,O.a=k),R!==O.o&&de(P,"overflow-x",O.o=R),Y!==O.i&&de(P,"scroll-snap-type",O.i=Y),A!==O.n&&f(V,O.n=A),m!==O.s&&de(V,"width",O.s=m),O.h=He(T,x,O.h),O},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),E}})},cs=e=>{if(!e)return;const t=e.querySelectorAll("video");t.length<=0||t.forEach(i=>{i.paused||i.pause()})},us="_clearFilter_1rh1x_1",vs="_dropdownWrapper_1rh1x_24",ms="_dateSelect_1rh1x_29",je={clearFilter:us,dropdownWrapper:vs,dateSelect:ms};var hs=L("<button popovertarget=filter-timeline style=anchor-name:--filter-timeline-trigger>"),fs=L('<div popover=auto id=filter-timeline class="popover-container filter_timeline"><div class=media_type_contents><button></button><span>Zoom </span><button></button></div><div></div><div style="border:none;margin:5px 5px 0 5px;padding:0"><p>Filter:</p><p>Clear</p></div><div class=media_type_contents></div><div class=media_type_contents style="padding:1.5px 8px"><div>Time:</div><div><select id=select-months-filter><option disabled>Months</option><option>All</option></select></div>/<div><select id=select-years-filter><option disabled>Years</option><option>All'),gs=L("<button>"),Ft=L("<option>"),_s=L("<span>"),bs=L("<div><span>Sort by ");const ps=1,$s=5,ws=()=>{const{view:e,params:t,setView:i,updatePage:o,updatePageKey:n}=ve(),{isSelected:d}=oe(),g=[{label:"Photo",className:"photos"},{label:"Live",className:"lives"},{label:"Video",className:"videos"}],r=(l="")=>{n("filterType",l)},c=l=>{o({sortKey:l,sortOrder:t.sortOrder?0:1})},p=[{type:"file_size",label:"Size"},{type:"create_date",label:"Created"},{type:"upload_at",label:"Uploaded"}],v=l=>{i("nColumn",a=>a+l)},y=()=>{o({year:void 0,month:void 0,filterType:void 0})},[I]=Ue(()=>[t.month],([l])=>yn(l)),h=[{label:"Dec",value:12},{label:"Nov",value:11},{label:"Oct",value:10},{label:"Sep",value:9},{label:"Aug",value:8},{label:"Jul",value:7},{label:"Jun",value:6},{label:"May",value:5},{label:"Apr",value:4},{label:"Mar",value:3},{label:"Feb",value:2},{label:"Jan",value:1}];return b(W,{get when(){return!d()},get children(){return[(()=>{var l=hs();return _(l,Fn),l})(),(()=>{var l=fs(),a=l.firstChild,u=a.firstChild,S=u.nextSibling,w=S.nextSibling,$=a.nextSibling,s=$.nextSibling,M=s.firstChild,D=M.nextSibling,E=s.nextSibling,P=E.nextSibling,V=P.firstChild,T=V.nextSibling,O=T.firstChild,U=O.firstChild,H=U.nextSibling,k=T.nextSibling,R=k.nextSibling,Y=R.firstChild,A=Y.firstChild,m=A.nextSibling;return u.$$click=()=>v(-1),_(u,ft),w.$$click=()=>v(1),_(w,Kt),$.$$click=()=>i("objectFit",x=>!x),_($,()=>e.objectFit?"Aspect Ratio Grid":"Square Photo Grid"),D.$$click=()=>y(),_(E,b(we,{each:g,children:({className:x,label:z})=>(()=>{var B=gs();return B.$$click=()=>r(z),N(()=>f(B,`icon_type ${x} ${t.filterType===z?"iconActiveFilter":""}`)),B})()})),O.$$input=x=>{const z=x.currentTarget.value;return o({month:Nt(z),year:void 0})},H.value=void 0,_(O,b(we,{each:h??[],children:x=>(()=>{var z=Ft();return _(z,()=>x.label),N(()=>z.value=x.value),z})()}),null),Y.$$input=x=>{const z=x.currentTarget.value;return n("year",Nt(z))},m.value=void 0,_(Y,b(we,{get each(){return I()??[]},children:x=>(()=>{var z=Ft();return _(z,()=>x.create_year),N(()=>z.selected=t.year===x.create_year),N(()=>z.value=x.create_year),z})()}),null),_(l,b(we,{each:p,children:({type:x,label:z})=>(()=>{var B=bs(),C=B.firstChild;return C.firstChild,B.$$click=()=>c(x),_(C,z,null),_(B,b(W,{get when(){return t.sortKey===x},get children(){var G=_s();return _(G,(()=>{var X=se(()=>t.sortOrder===0);return()=>X()?Nn():Vn()})()),G}}),null),N(()=>f(B,`sort_filter ${t.sortKey===x?"activeFilter":""}`)),B})()}),null),N(x=>{var z=e.nColumn===ps,B=e.nColumn===$s,C=je.clearFilter,G=je.dropdownWrapper,X=je.dateSelect,J=je.dropdownWrapper,ne=je.dateSelect,re=!t.year;return z!==x.e&&(u.disabled=x.e=z),B!==x.t&&(w.disabled=x.t=B),C!==x.a&&f(s,x.a=C),G!==x.o&&f(T,x.o=G),X!==x.i&&f(O,x.i=X),J!==x.n&&f(R,x.n=J),ne!==x.s&&f(Y,x.s=ne),re!==x.h&&(m.selected=x.h=re),x},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),N(()=>O.value=t.month),N(()=>Y.value=t.year),l})()]}})},Nt=e=>!e||Number.isNaN(Number(e))?void 0:Number(e);te(["click","input"]);var ys=L("<main><div><div aria-disabled> Photos and Videos"),Is=L("<h1>"),Ss=L("<p>");const xs=5,st=3,qe=2,Cs=()=>{const e=ht(),t=F(()=>e.pages),{isSelected:i}=oe(),{params:o,view:n,resetLibrary:d}=ve(),{openModal:g,displayMedias:r,setDisplayMedia:c}=ee(),[p,v]=K(!1);let y;const I=()=>({year:o.year,month:o.month,filterDevice:o.filterDevice,filterType:o.filterType,searchKey:o.searchKey,sortKey:o.sortKey,sortOrder:o.sortOrder,favorite:o.favorite,hidden:o.hidden,deleted:o.deleted,duplicate:o.duplicate,albumId:t()==="album"&&e.id?parseInt(e.id):void 0,locationId:t()==="places"&&e.id?parseInt(e.id):void 0}),[h,l]=K(0),[a,u]=K();be(()=>{requestAnimationFrame(()=>v(!0)),mi(a,([{isIntersecting:A}])=>{A&&(u(null),l(m=>m+1))},{root:y,threshold:.5,rootMargin:"300px"})});const S=()=>{const A=Wn("idx",r.length-1);A&&u(A)};F(()=>{const A=n.objectFit?"cover":"contain";document.documentElement.style.setProperty("--transition-object-fit",A)});const[w]=Ue(I,async A=>{const m=await yt(A);m&&(c(m),l(0),S())}),[$]=Ue(h,async A=>{if(A===0)return;const m=await yt(I(),A);m&&c(x=>[...x,...m])}),{width:s,height:M}=fi(),[D,E]=K(We.top),P=F(()=>(s()-qe*(n.nColumn-1))/n.nColumn),V=F(()=>P()+qe),T=F(()=>Math.ceil(r.length/n.nColumn)),O=F(()=>T()?T()*V()-qe:0),U=F(()=>(Math.ceil(M()/V())+st)*n.nColumn),H=F(()=>Math.max(0,(Math.floor(D()/V())-st)*n.nColumn)),k=F(()=>Math.min(r.length-1,H()+U()+st*n.nColumn)),R=F(()=>{if(r.length===0)return[];const A=H(),m=k();return r.slice(A,m+1)});Me(()=>d());const Y=F(()=>{const A=t()==="all"?M()-We.bottomTimelineWithResult:M()-We.bottomWithResult;return Math.max(A,O()+We.top)});return[b(Hn,{get left(){return[(()=>{var A=Is();return _(A,()=>an[t()]),A})(),b(W,{get when(){return r.length},get children(){var A=Ss();return _(A,()=>De(r[H()].create_date,"date").toString()),A}})]},get right(){return[b(wi,{}),b(W,{get when(){return n.nColumn<=xs},get children(){return b(Dr,{})}}),b(ws,{})]}}),(()=>{var A=ys(),m=A.firstChild,x=m.firstChild,z=x.firstChild;return A.addEventListener("scroll",B=>{E(y.scrollTop)}),he(B=>y=B,A),_(A,b(W,{get when(){return w.loading||$.loading},get children(){return b(Jt,{})}}),m),_(A,b(W,{get when(){return!r.length},get children(){return b(Gt,{errorCode:"Not Found",message:"Page you're looking for could not be found"})}}),m),_(m,b(we,{get each(){return R()},children:(B,C)=>b(_i,{get lastItem(){return r.length-1===H()+C()?u:void 0},media:B,get index(){return H()+C()},get itemDim(){return P()},gap:qe})}),x),_(x,()=>r.length,z),N(B=>{var C=`mainHomePage pageTransition ${p()?"pageEnter":""}`,G=Se.virtualContainer,X=`${O()}px`,J=Se.customBottomPadding,ne=`${t()==="all"?140:100}px`,re=`${Y()}px`;return C!==B.e&&f(A,B.e=C),G!==B.t&&f(m,B.t=G),X!==B.a&&de(m,"height",B.a=X),J!==B.o&&f(x,B.o=J),ne!==B.i&&de(x,"height",B.i=ne),re!==B.n&&de(x,"top",B.n=re),B},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),A})(),b(W,{get when(){return i()},get children(){return b(nn,{})}}),b(W,{get when(){return g.isOpen},get children(){return b(ds,{setLastEl:u})}})]},zs=()=>b(Zn,{get children(){return b(Yn,{get children(){return b(Cs,{})}})}});export{zs as default};

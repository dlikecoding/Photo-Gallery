import{f as ki,t as _,i as o,a as g,m as zi,s as xe,k as yi,d as I,e as t,I as Ri,b as Me,g as Ci,o as Vi,l as X,n as pi}from"./index-BvSQAnfI.js";import{s as i}from"./Setting.module-DgUIRGu_.js";import{R as Fi}from"./svgIcons-CL4uA8j0.js";import{y as Ui,z as Gi,A as Wi,B as qi,C as Zi,D as ji,E as Ji,F as Ki,G as wi,H as Qi}from"./fetching-CJXmvtht.js";import{I as Xi}from"./ImportLoading-DdWe640l.js";import{S as se}from"./SlideUp-3jdboGv6.js";import{f as _i}from"./helper-CM3Kw7rw.js";import{H as Yi}from"./Header-9gxCup_c.js";var et=_('<div><div><div>Recent events</div><button type=button popovertarget=delete-logs style="background-color:rgba(167, 0, 39, 0.9)">Clear All</button></div><ul>'),it=_("<li><div>[<!>] <!> – <!>@ </div><button>i</button><div popover=auto>");const tt=()=>{const[le,{refetch:de}]=ki(Gi),$e=async()=>{if(!(await Ui()).ok)return alert("Delete all logs is failed.");de()};return(()=>{var Z=et(),Q=Z.firstChild,ve=Q.firstChild,Y=ve.nextSibling,m=Q.nextSibling;return o(Q,g(se,{idElement:"delete-logs",noticeText:"WARNING! All existing logs in database will be delete. This action can not be undone.",confirmBtn:$e,infoText:()=>"Clear All Logs"}),null),o(m,g(Ri,{get each(){return le()??[]},children:(l,C)=>{const T=_i(l().timestmp),{date:D,time:v}=typeof T=="string"?{date:T,time:T}:T,x=`info-log-${C}`,M=`--info-trigger-${C}`;return(()=>{var ee=it(),P=ee.firstChild,ye=P.firstChild,ce=ye.nextSibling,Ce=ce.nextSibling,ie=Ce.nextSibling,we=ie.nextSibling,ue=we.nextSibling;ue.nextSibling;var r=P.nextSibling,w=r.nextSibling;return o(P,()=>l().title,ce),o(P,()=>D.toString(),ie),o(P,(()=>{var d=zi(()=>l().title==="INFO");return()=>d()?`${l().email} signed in from ${l().function_ip} `:`${l().function_ip} `})(),ue),o(P,()=>v.toString(),null),xe(r,"popovertarget",x),yi(r,"anchor-name",M),xe(w,"id",x),yi(w,"position-anchor",M),o(w,()=>l().stacktrace_useragent),I(d=>{var h=i.logsInfo,A=i.tagPill,B=i.infoLogsPopover;return h!==d.e&&t(ee,d.e=h),A!==d.t&&t(r,d.t=A),B!==d.a&&t(w,d.a=B),d},{e:void 0,t:void 0,a:void 0}),ee})()}})),I(l=>{var C=i.logsPreview,T=i.logsHeader,D=i.logsPreviewHeader,v=le()?.length===0,x=i.tagPill,M=i.logsPreviewList;return C!==l.e&&t(Z,l.e=C),T!==l.t&&t(Q,l.t=T),D!==l.a&&t(ve,l.a=D),v!==l.o&&(Y.disabled=l.o=v),x!==l.i&&t(Y,l.i=x),M!==l.n&&t(m,l.n=M),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),Z})()};var nt=_('<div><label for=importPath>External Drive</label><input class=inputSearch type=text id=importPath autocomplete=off placeholder=/Volumes/External/Photos style="padding:2px 7px">'),at=_("<div><div><span>Last restore</span><span></span></div><button type=button popovertarget=restore-database>Restore"),ot=_("<div><div style=display:flex;flex-direction:column><div><span>Reindex</span><span>Rebuild thumbnails, hashcodes and captions.</span></div><div><div><div>Thumbnail</div><div></div></div><div><div>Hashcode</div><div></div></div><div><div>Caption</div><div></div></div></div></div><button popovertarget=reindex-confirm type=button>Reindex"),rt=_("<main><div class=contentStack><section><div><div><div>Import Medias From </div><div></div></div><span>Ingestion</span></div><div><div><label><input type=checkbox id=detectModel><span>Computer vision for search engine</span><span></span></label><p>Enable this to generate visual features and captions during import. Disable to speedup the process.</p></div><div><button type=button></button></div></div></section><section><div><div><div>Server recovery</div><div>Backups, restore, and maintenance</div></div><span>Safety</span></div><div><div><div><div><span>Last backup</span><span></span></div><button type=button popovertarget=backup-database>Backup</button></div><div></div><div><div><span>Storage optimize</span><span>Optimize storage by reducing 120 fps to 60 fps for all of videos.</span></div><button popovertarget=optimal-storage type=button>Optimize</button></div><div><span>Scan for missing thumbnails</span><button type=button>Scan</button></div></div></div></section><section><div><div><div>Users</div><div>Active sessions and moderation</div></div><span>Access</span></div></section><section><div><div><div>Logs manager</div><div>User activity, audit trail, and error tracking</div></div><span>Observability</span></div><div><p>Centralized access to request logs, security events, and application errors.</p><div><button type=button>Open logs viewer</button><button type=button>Export latest bundle"),st=_("<h1>Admin Console"),lt=_("<p>Import, recovery, users, and logs"),dt=_("<button class=iconButton type=button>"),vt=_("<div>"),ct=_(`<div><div><div style="background-image:url('/src/assets/svgs/avatar.svg')"></div><div><p></p><p></p><button>Created: <!> @ </button></div></div><div><span></span><label><input type=checkbox><span><span>`);const $t=()=>{const[le,de]=Me(!1),[$e,Z]=Me(!1),[Q,ve]=Me(!1),Y=async r=>{Z(!0);try{await r()}finally{Z(!1)}},[m,{mutate:l,refetch:C}]=ki(Qi),T=async r=>{if(!(await Ki(r.user_email)).ok)return alert("Failed to update user status!");l(d=>{if(!d?.users)return d;const h=d.users.findIndex(B=>B.user_email===r.user_email);if(h===-1)return d;const A=[...d.users];return A[h]={...A[h],status:!A[h].status},{...d,users:A}})},[D,v]=Ci({mesg:"",isRunning:!1}),[x,M]=Ci({path:"",aimode:0}),ee=async()=>{v({mesg:"Start processing internal media"}),await wi(v,x,"internal"),C()},P=async()=>{if(!x.path)return alert("Do not accept empty path");v({mesg:`Start processing medias in ${x.path}`}),await wi(v,x,"external")},ye=async()=>{v({mesg:"Start backing up PhotoX System to external drive",isRunning:!0}),await Wi(v),C()},ce=async()=>{const r=await qi();alert(r.message),C()},Ce=async()=>{v({mesg:"Start optimizing videos in local server",isRunning:!0}),await Zi(v)},ie=()=>{const r=m();return!r||!r.missedData?!1:!Object.values(r.missedData).every(h=>h==0)},we=async()=>{ie()&&(v({mesg:"Start reindexing medias",isRunning:!0}),await Ji(v),C())},ue=async()=>{v({mesg:"Start scanning for missing thumbnails",isRunning:!0}),await ji(v)};return Vi(()=>{requestAnimationFrame(()=>ve(!0))}),[g(Yi,{get left(){return[st(),lt()]},get right(){return(()=>{var r=dt();return r.$$click=()=>Y(async()=>{C()}),o(r,g(X,{get when(){return!$e()},get fallback(){return(()=>{var w=vt();return I(()=>t(w,i.spinner)),w})()},get children(){return g(Fi,{})}})),r})()}}),(()=>{var r=rt(),w=r.firstChild,d=w.firstChild,h=d.firstChild,A=h.firstChild,B=A.firstChild;B.firstChild;var Pe=B.nextSibling,Ai=A.nextSibling,Ee=h.nextSibling,ge=Ee.firstChild,ke=ge.firstChild,He=ke.firstChild,Ti=He.nextSibling,Oe=Ti.nextSibling,Di=ke.nextSibling,Ne=ge.nextSibling,me=Ne.firstChild,Re=d.nextSibling,_e=Re.firstChild,ze=_e.firstChild,Ve=ze.firstChild,Bi=Ve.nextSibling,Li=ze.nextSibling,pe=_e.nextSibling,be=pe.firstChild,he=be.firstChild,Ae=he.firstChild,Fe=Ae.firstChild,Ue=Fe.nextSibling,Ge=Ae.nextSibling,Te=he.nextSibling,fe=Te.nextSibling,De=fe.firstChild,We=De.firstChild,Ii=We.nextSibling,Mi=De.nextSibling,qe=fe.nextSibling,Ze=qe.firstChild,je=Ze.nextSibling,Se=Re.nextSibling,Je=Se.firstChild,Ke=Je.firstChild,Qe=Ke.firstChild,Pi=Qe.nextSibling,Ei=Ke.nextSibling,Be=Se.nextSibling,Le=Be.firstChild,Xe=Le.firstChild,Ye=Xe.firstChild,Hi=Ye.nextSibling,Oi=Xe.nextSibling,ei=Le.nextSibling,ii=ei.firstChild,ti=ii.nextSibling,Ie=ti.firstChild,Ni=Ie.nextSibling;return o(B,()=>m()?.sysStatus?"External Drive":"Internal Directory",null),o(Pe,()=>m()?.sysStatus?"Select preferred path to import to server":"Importing media from main path to server"),He.addEventListener("change",()=>M("aimode",x.aimode===0?1:0)),o(Oe,()=>x.aimode?"Enabled":"Disabled"),o(ge,g(X,{get when(){return m()?.sysStatus},get children(){var e=nt(),u=e.firstChild,f=u.nextSibling;return f.$$input=c=>M("path",c.target.value),I(c=>{var S=i.importInput,s=i.checkboxRow;return S!==c.e&&t(e,c.e=S),s!==c.t&&t(u,c.t=s),c},{e:void 0,t:void 0}),e}}),null),me.$$click=()=>Y(async()=>{v("isRunning",!0),m()?.sysStatus?P():ee(),v("isRunning",!1)}),o(me,g(X,{get when(){return!D.isRunning},fallback:"Running…",children:"Start import"})),o(Ue,()=>m()?.lastBackup||"N/A"),o(he,g(se,{idElement:"backup-database",noticeText:"WARNING! All existing data on your external drive will be deleted and replace with current data in PhotoX system. This action can not be undone.",confirmBtn:ye,infoText:()=>"Backup PhotoX"}),null),o(be,g(X,{get when(){return m()?.lastBackup},get children(){var e=at(),u=e.firstChild,f=u.firstChild,c=f.nextSibling,S=u.nextSibling;return o(c,()=>m()?.lastRestore||"N/A"),o(e,g(se,{idElement:"restore-database",noticeText:"All existing database will be replace with the new data. This action can not be undone.",confirmBtn:ce,infoText:()=>"Restore Database"}),null),I(s=>{var k=i.recovertyMainActions,R=i.kvRow,$=i.kvLabel,y=i.kvValue,b=`${i.actionButton} ${i.actionSuccess}`;return k!==s.e&&t(e,s.e=k),R!==s.t&&t(u,s.t=R),$!==s.a&&t(f,s.a=$),y!==s.o&&t(c,s.o=y),b!==s.i&&t(S,s.i=b),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),e}}),Te),o(fe,g(se,{idElement:"optimal-storage",noticeText:"Start reducing frames per second for slow motion videos. This action can not be undone.",confirmBtn:Ce,infoText:()=>"Optimize Storage"}),null),je.$$click=ue,o(be,g(X,{get when(){return ie()},get children(){var e=ot(),u=e.firstChild,f=u.firstChild,c=f.firstChild,S=c.nextSibling,s=f.nextSibling,k=s.firstChild,R=k.firstChild,$=R.nextSibling,y=k.nextSibling,b=y.firstChild,j=b.nextSibling,J=y.nextSibling,E=J.firstChild,L=E.nextSibling,H=u.nextSibling;return o($,()=>m()?.missedData.thumbnail),o(j,()=>m()?.missedData.hashcode),o(L,()=>m()?.missedData.caption),o(e,g(se,{idElement:"reindex-confirm",noticeText:"Rebuilding missing thumbnail, hashcodes, and caption for all of the videos and images. This action will take a moment.",confirmBtn:we,infoText:()=>"Start Reindex"}),null),I(a=>{var O=i.recovertyMainActions,K=i.kvRow,n=i.kvLabel,N=i.kvValueMuted,z=i.metricRow,V=i.metricLabel,p=i.metricValue,F=i.metricLabel,U=i.metricValue,G=i.metricLabel,W=i.metricValue,q=`${i.actionButton} ${i.actionAccent}`;return O!==a.e&&t(e,a.e=O),K!==a.t&&t(f,a.t=K),n!==a.a&&t(c,a.a=n),N!==a.o&&t(S,a.o=N),z!==a.i&&t(s,a.i=z),V!==a.n&&t(R,a.n=V),p!==a.s&&t($,a.s=p),F!==a.h&&t(b,a.h=F),U!==a.r&&t(j,a.r=U),G!==a.d&&t(E,a.d=G),W!==a.l&&t(L,a.l=W),q!==a.u&&t(H,a.u=q),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0}),e}}),null),o(Se,g(Ri,{get each(){return m()?.users},children:e=>{const u=_i(e().created_at),{date:f,time:c}=typeof u=="string"?{date:u,time:u}:u;return(()=>{var S=ct(),s=S.firstChild,k=s.firstChild,R=k.nextSibling,$=R.firstChild,y=$.nextSibling,b=y.nextSibling,j=b.firstChild,J=j.nextSibling;J.nextSibling;var E=s.nextSibling,L=E.firstChild,H=L.nextSibling,a=H.firstChild,O=a.nextSibling,K=O.firstChild;return o($,()=>e().user_name),o(y,()=>e().user_email),b.$$click=()=>de(!0),o(b,f,J),o(b,c,null),o(L,()=>e().status?"Actived":"Suspended"),a.$$input=()=>T(e()),I(n=>{var N=i.userAdminCard,z=i.userInfoRow,V=i.userAvatarPlaceholder,p=i.userTextContainer,F=i.userName,U=i.userEmail,G=i.linkButton,W=i.userAdminRight,q=i.kvLabel,te=i.switch,ne=`toggle-${e().reg_user_id}`,ae=`toggle-${e().reg_user_id}`,oe=i.switchTrack,re=i.switchThumb;return N!==n.e&&t(S,n.e=N),z!==n.t&&t(s,n.t=z),V!==n.a&&t(k,n.a=V),p!==n.o&&t(R,n.o=p),F!==n.i&&t($,n.i=F),U!==n.n&&t(y,n.n=U),G!==n.s&&t(b,n.s=G),W!==n.h&&t(E,n.h=W),q!==n.r&&t(L,n.r=q),te!==n.d&&t(H,n.d=te),ne!==n.l&&xe(H,"for",n.l=ne),ae!==n.u&&xe(a,"id",n.u=ae),oe!==n.c&&t(O,n.c=oe),re!==n.w&&t(K,n.w=re),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),I(()=>a.checked=e().status),S})()}}),null),Ie.$$click=()=>de(e=>!e),o(Be,g(X,{get when(){return le()},get children(){return g(tt,{})}}),null),I(e=>{var u=`mainHomePage paddingHeader pageTransition ${Q()?"pageEnter":""}`,f=`${i.storageContainer} ${i.adminCard}`,c=i.storageHeaderRow,S=i.storageTitle,s=i.storageSubtitle,k=i.tagPill,R=i.importBody,$=i.importToggleRow,y=i.checkboxRow,b=i.badgeMuted,j=i.importHint,J=i.importActionsRow,E=D.isRunning,L=`${i.actionButton} ${i.actionPrimary}`,H=`${i.storageContainer} ${i.adminCard}`,a=i.storageHeaderRow,O=i.storageTitle,K=i.storageSubtitle,n=i.tagPill,N=i.recoveryGrid,z=i.recoveryMetaColumn,V=i.recovertyMainActions,p=i.kvRow,F=i.kvLabel,U=i.kvValue,G=`${i.actionButton} ${i.actionOutline}`,W=D.isRunning,q=i.recoveryDivider,te=i.recovertyMainActions,ne=i.kvRow,ae=i.kvLabel,oe=i.kvValueMuted,re=`${i.actionButton} ${i.actionWarning}`,ni=i.recovertyMainActions,ai=i.kvLabel,oi=`${i.actionButton} ${i.actionActive}`,ri=`${i.storageContainer} ${i.adminCard}`,si=i.storageHeaderRow,li=i.storageTitle,di=i.storageSubtitle,vi=i.tagPill,ci=`${i.storageContainer} ${i.adminCard}`,ui=i.storageHeaderRow,gi=i.storageTitle,mi=i.storageSubtitle,bi=i.tagPill,hi=i.logsBody,fi=i.logsHint,Si=i.logsActionsRow,xi=`${i.actionButton} ${i.actionAccent}`,$i=`${i.actionButton} ${i.actionOutlineMuted}`;return u!==e.e&&t(r,e.e=u),f!==e.t&&t(d,e.t=f),c!==e.a&&t(h,e.a=c),S!==e.o&&t(B,e.o=S),s!==e.i&&t(Pe,e.i=s),k!==e.n&&t(Ai,e.n=k),R!==e.s&&t(Ee,e.s=R),$!==e.h&&t(ge,e.h=$),y!==e.r&&t(ke,e.r=y),b!==e.d&&t(Oe,e.d=b),j!==e.l&&t(Di,e.l=j),J!==e.u&&t(Ne,e.u=J),E!==e.c&&(me.disabled=e.c=E),L!==e.w&&t(me,e.w=L),H!==e.m&&t(Re,e.m=H),a!==e.f&&t(_e,e.f=a),O!==e.y&&t(Ve,e.y=O),K!==e.g&&t(Bi,e.g=K),n!==e.p&&t(Li,e.p=n),N!==e.b&&t(pe,e.b=N),z!==e.T&&t(be,e.T=z),V!==e.A&&t(he,e.A=V),p!==e.O&&t(Ae,e.O=p),F!==e.I&&t(Fe,e.I=F),U!==e.S&&t(Ue,e.S=U),G!==e.W&&t(Ge,e.W=G),W!==e.C&&(Ge.disabled=e.C=W),q!==e.B&&t(Te,e.B=q),te!==e.v&&t(fe,e.v=te),ne!==e.k&&t(De,e.k=ne),ae!==e.x&&t(We,e.x=ae),oe!==e.j&&t(Ii,e.j=oe),re!==e.q&&t(Mi,e.q=re),ni!==e.z&&t(qe,e.z=ni),ai!==e.P&&t(Ze,e.P=ai),oi!==e.H&&t(je,e.H=oi),ri!==e.F&&t(Se,e.F=ri),si!==e.M&&t(Je,e.M=si),li!==e.D&&t(Qe,e.D=li),di!==e.R&&t(Pi,e.R=di),vi!==e.E&&t(Ei,e.E=vi),ci!==e.L&&t(Be,e.L=ci),ui!==e.N&&t(Le,e.N=ui),gi!==e.G&&t(Ye,e.G=gi),mi!==e.U&&t(Hi,e.U=mi),bi!==e.K&&t(Oi,e.K=bi),hi!==e.V&&t(ei,e.V=hi),fi!==e.Y&&t(ii,e.Y=fi),Si!==e.J&&t(ti,e.J=Si),xi!==e.Q&&t(Ie,e.Q=xi),$i!==e.Z&&t(Ni,e.Z=$i),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0,f:void 0,y:void 0,g:void 0,p:void 0,b:void 0,T:void 0,A:void 0,O:void 0,I:void 0,S:void 0,W:void 0,C:void 0,B:void 0,v:void 0,k:void 0,x:void 0,j:void 0,q:void 0,z:void 0,P:void 0,H:void 0,F:void 0,M:void 0,D:void 0,R:void 0,E:void 0,L:void 0,N:void 0,G:void 0,U:void 0,K:void 0,V:void 0,Y:void 0,J:void 0,Q:void 0,Z:void 0}),r})(),g(Xi,{streamMesg:D,setStreamMesg:v})]};pi(["input","click"]);export{$t as AdminDashboardView,$t as default};
